/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { QueryOptions } from '../query-options/query-options';
import { Utils } from '../utils/utils';
import { ODataQueryAbstract } from './odata-query-abstract';
import { ODataQueryBatch } from './odata-query-batch';
export class ODataQuery extends ODataQueryAbstract {
    /**
     * @param {?} odataService
     * @param {?} serviceRoot
     */
    constructor(odataService, serviceRoot) {
        super(odataService, serviceRoot);
        Utils.requireNotNullNorUndefined(odataService, 'odataService');
        Utils.requireNotNullNorUndefined(serviceRoot, 'serviceRoot');
        Utils.requireNotEmpty(serviceRoot, 'serviceRoot');
        this.queryOptions = new QueryOptions(ODataQuery.SEPARATOR);
        this.segments = [];
        this.lastSegment = null;
    }
    /**
     * @return {?}
     */
    metadata() {
        Utils.requireNullOrUndefined(this.getSegment(ODataQuery.METADATA), ODataQuery.METADATA);
        if (this.segments.length) {
            throw new Error('metadata segment cannot be appended to other segments');
        }
        this.queryString = Utils.appendSegment(this.queryString, ODataQuery.$METADATA);
        this.addSegment(ODataQuery.METADATA);
        return this;
    }
    /**
     * @param {?} entitySet
     * @return {?}
     */
    entitySet(entitySet) {
        Utils.requireNullOrUndefined(this.getSegment(ODataQuery.ENTITY_SET), ODataQuery.ENTITY_SET);
        Utils.requireNotNullNorUndefined(entitySet, 'entitySet');
        Utils.requireNotEmpty(entitySet, 'entitySet');
        this.queryString = Utils.appendSegment(this.queryString, entitySet);
        this.addSegment(ODataQuery.ENTITY_SET);
        return this;
    }
    /**
     * @param {?} entityKey
     * @return {?}
     */
    entityKey(entityKey) {
        if (this.lastSegment !== ODataQuery.ENTITY_SET && this.lastSegment !== ODataQuery.NAVIGATION_PROPERTY) {
            throw new Error('entityKey can only be appended to entitySet or navigationProperty');
        }
        Utils.requireNotNullNorUndefined(entityKey, 'entityKey');
        Utils.requireNotEmpty(entityKey, 'entityKey');
        entityKey = Utils.getValueURI(entityKey, true);
        this.queryString = Utils.removeEndingSeparator(this.queryString) + '(' + entityKey + ')';
        this.addSegment(ODataQuery.ENTITY_KEY);
        return this;
    }
    /**
     * @param {?} singleton
     * @return {?}
     */
    singleton(singleton) {
        if (this.segments.length) {
            throw new Error('singleton segment cannot be appended to other segments');
        }
        Utils.requireNotNullNorUndefined(singleton, 'singleton');
        Utils.requireNotEmpty(singleton, 'singleton');
        this.queryString = Utils.appendSegment(this.queryString, singleton);
        this.addSegment(ODataQuery.SINGLETON);
        return this;
    }
    /**
     * @param {?} typeName
     * @return {?}
     */
    typeName(typeName) {
        if (this.lastSegment !== ODataQuery.ENTITY_SET && this.lastSegment !== ODataQuery.NAVIGATION_PROPERTY && this.lastSegment !== ODataQuery.ENTITY_KEY) {
            throw new Error('typeName can only be appended to entitySet, navigationProperty or entityKey');
        }
        Utils.requireNotNullNorUndefined(typeName, 'typeName');
        Utils.requireNotEmpty(typeName, 'typeName');
        this.queryString = Utils.appendSegment(this.queryString, typeName);
        this.addSegment(ODataQuery.TYPE_NAME);
        return this;
    }
    /**
     * @param {?} property
     * @return {?}
     */
    property(property) {
        Utils.requireNullOrUndefined(this.getSegment(ODataQuery.PROPERTY), ODataQuery.PROPERTY);
        if (this.lastSegment !== ODataQuery.ENTITY_KEY && this.lastSegment !== ODataQuery.SINGLETON) {
            throw new Error('property can only be appended to entityKey or singleton');
        }
        Utils.requireNotNullNorUndefined(property, 'property');
        Utils.requireNotEmpty(property, 'property');
        this.queryString = Utils.appendSegment(this.queryString, property);
        this.addSegment(ODataQuery.PROPERTY);
        return this;
    }
    /**
     * @param {?} navigationProperty
     * @return {?}
     */
    navigationProperty(navigationProperty) {
        if (this.lastSegment !== ODataQuery.ENTITY_KEY && this.lastSegment !== ODataQuery.SINGLETON && this.lastSegment !== ODataQuery.TYPE_NAME) {
            throw new Error('navigationProperty can only be appended to entityKey, singleton or typeName');
        }
        Utils.requireNotNullNorUndefined(navigationProperty, 'navigationProperty');
        Utils.requireNotEmpty(navigationProperty, 'navigationProperty');
        this.queryString = Utils.appendSegment(this.queryString, navigationProperty);
        this.addSegment(ODataQuery.NAVIGATION_PROPERTY);
        return this;
    }
    /**
     * @return {?}
     */
    ref() {
        Utils.requireNullOrUndefined(this.getSegment(ODataQuery.REF), ODataQuery.REF);
        if (this.lastSegment !== ODataQuery.NAVIGATION_PROPERTY) {
            throw new Error('ref can only be appended to navigationProperty');
        }
        this.queryString = Utils.appendSegment(this.queryString, ODataQuery.$REF);
        this.addSegment(ODataQuery.REF);
        return this;
    }
    /**
     * @return {?}
     */
    value() {
        Utils.requireNullOrUndefined(this.getSegment(ODataQuery.VALUE), ODataQuery.VALUE);
        if (this.lastSegment !== ODataQuery.PROPERTY) {
            throw new Error('value can only be appended to property');
        }
        this.queryString = Utils.appendSegment(this.queryString, ODataQuery.$VALUE);
        this.addSegment(ODataQuery.VALUE);
        return this;
    }
    /**
     * @return {?}
     */
    countSegment() {
        Utils.requireNullOrUndefined(this.getSegment(ODataQuery.COUNT), ODataQuery.COUNT);
        if (this.lastSegment !== ODataQuery.ENTITY_SET && this.lastSegment !== ODataQuery.NAVIGATION_PROPERTY) {
            throw new Error('count can only be appended to entitySet or navigationProperty');
        }
        this.queryString = Utils.appendSegment(this.queryString, ODataQuery.$COUNT);
        this.addSegment(ODataQuery.COUNT);
        return this;
    }
    /**
     * @param {?} functionCall
     * @return {?}
     */
    functionCall(functionCall) {
        Utils.requireNotNullNorUndefined(functionCall, 'functionCall');
        Utils.requireNotEmpty(functionCall, 'functionCall');
        this.queryString = Utils.appendSegment(this.queryString, functionCall);
        this.addSegment(ODataQuery.FUNCTION_CALL);
        return this;
    }
    /**
     * @param {?} actionCall
     * @return {?}
     */
    actionCall(actionCall) {
        Utils.requireNotNullNorUndefined(actionCall, 'actionCall');
        Utils.requireNotEmpty(actionCall, 'actionCall');
        this.queryString = Utils.appendSegment(this.queryString, actionCall);
        this.addSegment(ODataQuery.ACTION_CALL);
        return this;
    }
    /**
     * @return {?}
     */
    batch() {
        return new ODataQueryBatch(this.odataService, this.serviceRoot);
    }
    /**
     * @param {?} select
     * @return {?}
     */
    select(select) {
        this.queryOptions.select(select);
        return this;
    }
    /**
     * @param {?} filter
     * @return {?}
     */
    filter(filter) {
        this.queryOptions.filter(filter);
        return this;
    }
    /**
     * @param {?} expand
     * @return {?}
     */
    expand(expand) {
        this.queryOptions.expand(expand);
        return this;
    }
    /**
     * @param {?} orderby
     * @return {?}
     */
    orderby(orderby) {
        this.queryOptions.orderby(orderby);
        return this;
    }
    /**
     * @param {?} search
     * @return {?}
     */
    search(search) {
        this.queryOptions.search(search);
        return this;
    }
    /**
     * @param {?} skip
     * @return {?}
     */
    skip(skip) {
        this.queryOptions.skip(skip);
        return this;
    }
    /**
     * @param {?} top
     * @return {?}
     */
    top(top) {
        this.queryOptions.top(top);
        return this;
    }
    /**
     * @param {?} count
     * @return {?}
     */
    countOption(count) {
        this.queryOptions.count(count);
        return this;
    }
    /**
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    customOption(key, value) {
        this.queryOptions.customOption(key, value);
        return this;
    }
    /**
     * @param {?} format
     * @return {?}
     */
    format(format) {
        this.queryOptions.format(format);
        return this;
    }
    /**
     * @param {?=} httpOptions
     * @return {?}
     */
    get(httpOptions) {
        return this.odataService.get(this, httpOptions);
    }
    /**
     * @param {?} body
     * @param {?=} httpOptions
     * @return {?}
     */
    post(body, httpOptions) {
        return this.odataService.post(this, body, httpOptions);
    }
    /**
     * @param {?} body
     * @param {?=} etag
     * @param {?=} httpOptions
     * @return {?}
     */
    patch(body, etag, httpOptions) {
        return this.odataService.patch(this, body, etag, httpOptions);
    }
    /**
     * @param {?} body
     * @param {?=} etag
     * @param {?=} httpOptions
     * @return {?}
     */
    put(body, etag, httpOptions) {
        return this.odataService.put(this, body, etag, httpOptions);
    }
    /**
     * @param {?=} etag
     * @param {?=} httpOptions
     * @return {?}
     */
    delete(etag, httpOptions) {
        return this.odataService.delete(this, etag, httpOptions);
    }
    /**
     * @return {?}
     */
    toString() {
        /** @type {?} */
        let res = this.queryString;
        if (Utils.isNotNullNorUndefined(this.queryOptions) && !this.queryOptions.isEmpty()) {
            res += '?' + this.queryOptions.toString();
        }
        return res;
    }
    /**
     * @param {?} segment
     * @return {?}
     */
    getSegment(segment) {
        Utils.requireNotNull(segment, 'segment');
        /** @type {?} */
        const res = this.segments.find((value, index, segments) => {
            return value === segment;
        });
        return res;
    }
    /**
     * @param {?} segment
     * @return {?}
     */
    addSegment(segment) {
        Utils.requireNotNull(segment, 'segment');
        this.segments.push(segment);
        if (Utils.isNotNullNorUndefined(this.segments) && this.segments.length) {
            this.lastSegment = this.segments[this.segments.length - 1];
        }
    }
}
// QUERY OPTIONS SEPARATOR
ODataQuery.SEPARATOR = '&';
ODataQuery.METADATA = 'metadata';
ODataQuery.ENTITY_SET = 'entitySet';
ODataQuery.ENTITY_KEY = 'entityKey';
ODataQuery.SINGLETON = 'singleton';
ODataQuery.TYPE_NAME = 'typeName';
ODataQuery.PROPERTY = 'property';
ODataQuery.NAVIGATION_PROPERTY = 'navigationProperty';
ODataQuery.REF = 'ref';
ODataQuery.VALUE = 'value';
ODataQuery.COUNT = 'count';
ODataQuery.FUNCTION_CALL = 'functionCall';
ODataQuery.ACTION_CALL = 'actionCall';
ODataQuery.$METADATA = '$metadata';
ODataQuery.$REF = '$ref';
ODataQuery.$VALUE = '$value';
ODataQuery.$COUNT = '$count';
if (false) {
    /** @type {?} */
    ODataQuery.SEPARATOR;
    /** @type {?} */
    ODataQuery.METADATA;
    /** @type {?} */
    ODataQuery.ENTITY_SET;
    /** @type {?} */
    ODataQuery.ENTITY_KEY;
    /** @type {?} */
    ODataQuery.SINGLETON;
    /** @type {?} */
    ODataQuery.TYPE_NAME;
    /** @type {?} */
    ODataQuery.PROPERTY;
    /** @type {?} */
    ODataQuery.NAVIGATION_PROPERTY;
    /** @type {?} */
    ODataQuery.REF;
    /** @type {?} */
    ODataQuery.VALUE;
    /** @type {?} */
    ODataQuery.COUNT;
    /** @type {?} */
    ODataQuery.FUNCTION_CALL;
    /** @type {?} */
    ODataQuery.ACTION_CALL;
    /** @type {?} */
    ODataQuery.$METADATA;
    /** @type {?} */
    ODataQuery.$REF;
    /** @type {?} */
    ODataQuery.$VALUE;
    /** @type {?} */
    ODataQuery.$COUNT;
    /** @type {?} */
    ODataQuery.prototype.queryOptions;
    /** @type {?} */
    ODataQuery.prototype.segments;
    /** @type {?} */
    ODataQuery.prototype.lastSegment;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2RhdGEtcXVlcnkuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9vZGF0YS12NC1uZy8iLCJzb3VyY2VzIjpbImxpYi9vZGF0YS1xdWVyeS9vZGF0YS1xdWVyeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBUUEsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRTlELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN2QyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFdEQsTUFBTSxpQkFBa0IsU0FBUSxrQkFBa0I7Ozs7O0lBNkJoRCxZQUFZLFlBQTBCLEVBQUUsV0FBbUI7UUFDekQsS0FBSyxDQUFDLFlBQVksRUFBRSxXQUFXLENBQUMsQ0FBQztRQUNqQyxLQUFLLENBQUMsMEJBQTBCLENBQUMsWUFBWSxFQUFFLGNBQWMsQ0FBQyxDQUFDO1FBQy9ELEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxXQUFXLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDN0QsS0FBSyxDQUFDLGVBQWUsQ0FBQyxXQUFXLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDbEQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLFlBQVksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDM0QsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDbkIsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7S0FDekI7Ozs7SUFJRCxRQUFRO1FBQ04sS0FBSyxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN4RixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDekIsTUFB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QU8sQ0FBQztTQUMxQixDQUFDLENBQUM7UUFDSCxNQUFNLENBQUMsR0FBRyxDQUFDO0tBQ1o7Ozs7O0lBRVMsVUFBVSxDQUFDLE9BQWU7UUFDbEMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDNUIsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDdkUsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1NBQzVEO0tBQ0Y7Ozt1QkFyUTJCLEdBQUc7c0JBR0ksVUFBVTt3QkFDUixXQUFXO3dCQUNYLFdBQVc7dUJBQ1osV0FBVzt1QkFDWCxVQUFVO3NCQUNYLFVBQVU7aUNBQ0Msb0JBQW9CO2lCQUNwQyxLQUFLO21CQUNILE9BQU87bUJBQ1AsT0FBTzsyQkFDQyxjQUFjO3lCQUNoQixZQUFZO3VCQUdkLFdBQVc7a0JBQ2hCLE1BQU07b0JBQ0osUUFBUTtvQkFDUixRQUFRIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBPRGF0YVJlc3BvbnNlIH0gZnJvbSAnLi4vb2RhdGEtcmVzcG9uc2Uvb2RhdGEtcmVzcG9uc2UnO1xuaW1wb3J0IHsgSHR0cE9wdGlvbnNJIH0gZnJvbSAnLi4vb2RhdGEtc2VydmljZS9odHRwLW9wdGlvbnMnO1xuaW1wb3J0IHsgT0RhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vb2RhdGEtc2VydmljZS9vZGF0YS5zZXJ2aWNlJztcbmltcG9ydCB7IEV4cGFuZCB9IGZyb20gJy4uL3F1ZXJ5LW9wdGlvbnMvZXhwYW5kJztcbmltcG9ydCB7IEZpbHRlciB9IGZyb20gJy4uL3F1ZXJ5LW9wdGlvbnMvZmlsdGVyL2ZpbHRlcic7XG5pbXBvcnQgeyBPcmRlcmJ5IH0gZnJvbSAnLi4vcXVlcnktb3B0aW9ucy9vcmRlcmJ5JztcbmltcG9ydCB7IFF1ZXJ5T3B0aW9ucyB9IGZyb20gJy4uL3F1ZXJ5LW9wdGlvbnMvcXVlcnktb3B0aW9ucyc7XG5pbXBvcnQgeyBTZWFyY2ggfSBmcm9tICcuLi9xdWVyeS1vcHRpb25zL3NlYXJjaC9zZWFyY2gnO1xuaW1wb3J0IHsgVXRpbHMgfSBmcm9tICcuLi91dGlscy91dGlscyc7XG5pbXBvcnQgeyBPRGF0YVF1ZXJ5QWJzdHJhY3QgfSBmcm9tICcuL29kYXRhLXF1ZXJ5LWFic3RyYWN0JztcbmltcG9ydCB7IE9EYXRhUXVlcnlCYXRjaCB9IGZyb20gJy4vb2RhdGEtcXVlcnktYmF0Y2gnO1xuXG5leHBvcnQgY2xhc3MgT0RhdGFRdWVyeSBleHRlbmRzIE9EYXRhUXVlcnlBYnN0cmFjdCB7XG4gIC8vIFFVRVJZIE9QVElPTlMgU0VQQVJBVE9SXG4gIHN0YXRpYyByZWFkb25seSBTRVBBUkFUT1IgPSAnJic7XG5cbiAgLy8gU0VHTUVOVCBOQU1FU1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBNRVRBREFUQSA9ICdtZXRhZGF0YSc7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IEVOVElUWV9TRVQgPSAnZW50aXR5U2V0JztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgRU5USVRZX0tFWSA9ICdlbnRpdHlLZXknO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBTSU5HTEVUT04gPSAnc2luZ2xldG9uJztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgVFlQRV9OQU1FID0gJ3R5cGVOYW1lJztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgUFJPUEVSVFkgPSAncHJvcGVydHknO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBOQVZJR0FUSU9OX1BST1BFUlRZID0gJ25hdmlnYXRpb25Qcm9wZXJ0eSc7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFJFRiA9ICdyZWYnO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBWQUxVRSA9ICd2YWx1ZSc7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IENPVU5UID0gJ2NvdW50JztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgRlVOQ1RJT05fQ0FMTCA9ICdmdW5jdGlvbkNhbGwnO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBBQ1RJT05fQ0FMTCA9ICdhY3Rpb25DYWxsJztcblxuICAvLyBDT05TVEFOVCBTRUdNRU5UU1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSAkTUVUQURBVEEgPSAnJG1ldGFkYXRhJztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgJFJFRiA9ICckcmVmJztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgJFZBTFVFID0gJyR2YWx1ZSc7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5ICRDT1VOVCA9ICckY291bnQnO1xuXG4gIC8vIFZBUklBQkxFU1xuICBwcml2YXRlIHF1ZXJ5T3B0aW9uczogUXVlcnlPcHRpb25zO1xuICBwcml2YXRlIHNlZ21lbnRzOiBzdHJpbmdbXTtcbiAgcHJpdmF0ZSBsYXN0U2VnbWVudDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKG9kYXRhU2VydmljZTogT0RhdGFTZXJ2aWNlLCBzZXJ2aWNlUm9vdDogc3RyaW5nKSB7XG4gICAgc3VwZXIob2RhdGFTZXJ2aWNlLCBzZXJ2aWNlUm9vdCk7XG4gICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQob2RhdGFTZXJ2aWNlLCAnb2RhdGFTZXJ2aWNlJyk7XG4gICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQoc2VydmljZVJvb3QsICdzZXJ2aWNlUm9vdCcpO1xuICAgIFV0aWxzLnJlcXVpcmVOb3RFbXB0eShzZXJ2aWNlUm9vdCwgJ3NlcnZpY2VSb290Jyk7XG4gICAgdGhpcy5xdWVyeU9wdGlvbnMgPSBuZXcgUXVlcnlPcHRpb25zKE9EYXRhUXVlcnkuU0VQQVJBVE9SKTtcbiAgICB0aGlzLnNlZ21lbnRzID0gW107XG4gICAgdGhpcy5sYXN0U2VnbWVudCA9IG51bGw7XG4gIH1cblxuICAvLyBRVUVSWSBTRUdNRU5UU1xuXG4gIG1ldGFkYXRhKCk6IE9EYXRhUXVlcnkge1xuICAgIFV0aWxzLnJlcXVpcmVOdWxsT3JVbmRlZmluZWQodGhpcy5nZXRTZWdtZW50KE9EYXRhUXVlcnkuTUVUQURBVEEpLCBPRGF0YVF1ZXJ5Lk1FVEFEQVRBKTtcbiAgICBpZiAodGhpcy5zZWdtZW50cy5sZW5ndGgpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignbWV0YWRhdGEgc2VnbWVudCBjYW5ub3QgYmUgYXBwZW5kZWQgdG8gb3RoZXIgc2VnbWVudHMnKTtcbiAgICB9XG4gICAgdGhpcy5xdWVyeVN0cmluZyA9IFV0aWxzLmFwcGVuZFNlZ21lbnQodGhpcy5xdWVyeVN0cmluZywgT0RhdGFRdWVyeS4kTUVUQURBVEEpO1xuICAgIHRoaXMuYWRkU2VnbWVudChPRGF0YVF1ZXJ5Lk1FVEFEQVRBKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGVudGl0eVNldChlbnRpdHlTZXQ6IHN0cmluZyk6IE9EYXRhUXVlcnkge1xuICAgIFV0aWxzLnJlcXVpcmVOdWxsT3JVbmRlZmluZWQodGhpcy5nZXRTZWdtZW50KE9EYXRhUXVlcnkuRU5USVRZX1NFVCksIE9EYXRhUXVlcnkuRU5USVRZX1NFVCk7XG4gICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQoZW50aXR5U2V0LCAnZW50aXR5U2V0Jyk7XG4gICAgVXRpbHMucmVxdWlyZU5vdEVtcHR5KGVudGl0eVNldCwgJ2VudGl0eVNldCcpO1xuICAgIHRoaXMucXVlcnlTdHJpbmcgPSBVdGlscy5hcHBlbmRTZWdtZW50KHRoaXMucXVlcnlTdHJpbmcsIGVudGl0eVNldCk7XG4gICAgdGhpcy5hZGRTZWdtZW50KE9EYXRhUXVlcnkuRU5USVRZX1NFVCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBlbnRpdHlLZXkoZW50aXR5S2V5OiBhbnkgfCBhbnlbXSk6IE9EYXRhUXVlcnkge1xuICAgIGlmICh0aGlzLmxhc3RTZWdtZW50ICE9PSBPRGF0YVF1ZXJ5LkVOVElUWV9TRVQgJiYgdGhpcy5sYXN0U2VnbWVudCAhPT0gT0RhdGFRdWVyeS5OQVZJR0FUSU9OX1BST1BFUlRZKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2VudGl0eUtleSBjYW4gb25seSBiZSBhcHBlbmRlZCB0byBlbnRpdHlTZXQgb3IgbmF2aWdhdGlvblByb3BlcnR5Jyk7XG4gICAgfVxuICAgIFV0aWxzLnJlcXVpcmVOb3ROdWxsTm9yVW5kZWZpbmVkKGVudGl0eUtleSwgJ2VudGl0eUtleScpO1xuICAgIFV0aWxzLnJlcXVpcmVOb3RFbXB0eShlbnRpdHlLZXksICdlbnRpdHlLZXknKTtcbiAgICBlbnRpdHlLZXkgPSBVdGlscy5nZXRWYWx1ZVVSSShlbnRpdHlLZXksIHRydWUpO1xuICAgIHRoaXMucXVlcnlTdHJpbmcgPSBVdGlscy5yZW1vdmVFbmRpbmdTZXBhcmF0b3IodGhpcy5xdWVyeVN0cmluZykgKyAnKCcgKyBlbnRpdHlLZXkgKyAnKSc7XG4gICAgdGhpcy5hZGRTZWdtZW50KE9EYXRhUXVlcnkuRU5USVRZX0tFWSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzaW5nbGV0b24oc2luZ2xldG9uOiBzdHJpbmcpIHtcbiAgICBpZiAodGhpcy5zZWdtZW50cy5sZW5ndGgpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignc2luZ2xldG9uIHNlZ21lbnQgY2Fubm90IGJlIGFwcGVuZGVkIHRvIG90aGVyIHNlZ21lbnRzJyk7XG4gICAgfVxuICAgIFV0aWxzLnJlcXVpcmVOb3ROdWxsTm9yVW5kZWZpbmVkKHNpbmdsZXRvbiwgJ3NpbmdsZXRvbicpO1xuICAgIFV0aWxzLnJlcXVpcmVOb3RFbXB0eShzaW5nbGV0b24sICdzaW5nbGV0b24nKTtcbiAgICB0aGlzLnF1ZXJ5U3RyaW5nID0gVXRpbHMuYXBwZW5kU2VnbWVudCh0aGlzLnF1ZXJ5U3RyaW5nLCBzaW5nbGV0b24pO1xuICAgIHRoaXMuYWRkU2VnbWVudChPRGF0YVF1ZXJ5LlNJTkdMRVRPTik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICB0eXBlTmFtZSh0eXBlTmFtZTogc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMubGFzdFNlZ21lbnQgIT09IE9EYXRhUXVlcnkuRU5USVRZX1NFVCAmJiB0aGlzLmxhc3RTZWdtZW50ICE9PSBPRGF0YVF1ZXJ5Lk5BVklHQVRJT05fUFJPUEVSVFkgJiYgdGhpcy5sYXN0U2VnbWVudCAhPT0gT0RhdGFRdWVyeS5FTlRJVFlfS0VZKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3R5cGVOYW1lIGNhbiBvbmx5IGJlIGFwcGVuZGVkIHRvIGVudGl0eVNldCwgbmF2aWdhdGlvblByb3BlcnR5IG9yIGVudGl0eUtleScpO1xuICAgIH1cbiAgICBVdGlscy5yZXF1aXJlTm90TnVsbE5vclVuZGVmaW5lZCh0eXBlTmFtZSwgJ3R5cGVOYW1lJyk7XG4gICAgVXRpbHMucmVxdWlyZU5vdEVtcHR5KHR5cGVOYW1lLCAndHlwZU5hbWUnKTtcbiAgICB0aGlzLnF1ZXJ5U3RyaW5nID0gVXRpbHMuYXBwZW5kU2VnbWVudCh0aGlzLnF1ZXJ5U3RyaW5nLCB0eXBlTmFtZSk7XG4gICAgdGhpcy5hZGRTZWdtZW50KE9EYXRhUXVlcnkuVFlQRV9OQU1FKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHByb3BlcnR5KHByb3BlcnR5OiBzdHJpbmcpOiBPRGF0YVF1ZXJ5IHtcbiAgICBVdGlscy5yZXF1aXJlTnVsbE9yVW5kZWZpbmVkKHRoaXMuZ2V0U2VnbWVudChPRGF0YVF1ZXJ5LlBST1BFUlRZKSwgT0RhdGFRdWVyeS5QUk9QRVJUWSk7XG4gICAgaWYgKHRoaXMubGFzdFNlZ21lbnQgIT09IE9EYXRhUXVlcnkuRU5USVRZX0tFWSAmJiB0aGlzLmxhc3RTZWdtZW50ICE9PSBPRGF0YVF1ZXJ5LlNJTkdMRVRPTikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdwcm9wZXJ0eSBjYW4gb25seSBiZSBhcHBlbmRlZCB0byBlbnRpdHlLZXkgb3Igc2luZ2xldG9uJyk7XG4gICAgfVxuICAgIFV0aWxzLnJlcXVpcmVOb3ROdWxsTm9yVW5kZWZpbmVkKHByb3BlcnR5LCAncHJvcGVydHknKTtcbiAgICBVdGlscy5yZXF1aXJlTm90RW1wdHkocHJvcGVydHksICdwcm9wZXJ0eScpO1xuICAgIHRoaXMucXVlcnlTdHJpbmcgPSBVdGlscy5hcHBlbmRTZWdtZW50KHRoaXMucXVlcnlTdHJpbmcsIHByb3BlcnR5KTtcbiAgICB0aGlzLmFkZFNlZ21lbnQoT0RhdGFRdWVyeS5QUk9QRVJUWSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBuYXZpZ2F0aW9uUHJvcGVydHkobmF2aWdhdGlvblByb3BlcnR5OiBzdHJpbmcpOiBPRGF0YVF1ZXJ5IHtcbiAgICBpZiAodGhpcy5sYXN0U2VnbWVudCAhPT0gT0RhdGFRdWVyeS5FTlRJVFlfS0VZICYmIHRoaXMubGFzdFNlZ21lbnQgIT09IE9EYXRhUXVlcnkuU0lOR0xFVE9OICYmIHRoaXMubGFzdFNlZ21lbnQgIT09IE9EYXRhUXVlcnkuVFlQRV9OQU1FKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ25hdmlnYXRpb25Qcm9wZXJ0eSBjYW4gb25seSBiZSBhcHBlbmRlZCB0byBlbnRpdHlLZXksIHNpbmdsZXRvbiBvciB0eXBlTmFtZScpO1xuICAgIH1cbiAgICBVdGlscy5yZXF1aXJlTm90TnVsbE5vclVuZGVmaW5lZChuYXZpZ2F0aW9uUHJvcGVydHksICduYXZpZ2F0aW9uUHJvcGVydHknKTtcbiAgICBVdGlscy5yZXF1aXJlTm90RW1wdHkobmF2aWdhdGlvblByb3BlcnR5LCAnbmF2aWdhdGlvblByb3BlcnR5Jyk7XG4gICAgdGhpcy5xdWVyeVN0cmluZyA9IFV0aWxzLmFwcGVuZFNlZ21lbnQodGhpcy5xdWVyeVN0cmluZywgbmF2aWdhdGlvblByb3BlcnR5KTtcbiAgICB0aGlzLmFkZFNlZ21lbnQoT0RhdGFRdWVyeS5OQVZJR0FUSU9OX1BST1BFUlRZKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHJlZigpOiBPRGF0YVF1ZXJ5IHtcbiAgICBVdGlscy5yZXF1aXJlTnVsbE9yVW5kZWZpbmVkKHRoaXMuZ2V0U2VnbWVudChPRGF0YVF1ZXJ5LlJFRiksIE9EYXRhUXVlcnkuUkVGKTtcbiAgICBpZiAodGhpcy5sYXN0U2VnbWVudCAhPT0gT0RhdGFRdWVyeS5OQVZJR0FUSU9OX1BST1BFUlRZKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3JlZiBjYW4gb25seSBiZSBhcHBlbmRlZCB0byBuYXZpZ2F0aW9uUHJvcGVydHknKTtcbiAgICB9XG4gICAgdGhpcy5xdWVyeVN0cmluZyA9IFV0aWxzLmFwcGVuZFNlZ21lbnQodGhpcy5xdWVyeVN0cmluZywgT0RhdGFRdWVyeS4kUkVGKTtcbiAgICB0aGlzLmFkZFNlZ21lbnQoT0RhdGFRdWVyeS5SRUYpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgdmFsdWUoKTogT0RhdGFRdWVyeSB7XG4gICAgVXRpbHMucmVxdWlyZU51bGxPclVuZGVmaW5lZCh0aGlzLmdldFNlZ21lbnQoT0RhdGFRdWVyeS5WQUxVRSksIE9EYXRhUXVlcnkuVkFMVUUpO1xuICAgIGlmICh0aGlzLmxhc3RTZWdtZW50ICE9PSBPRGF0YVF1ZXJ5LlBST1BFUlRZKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3ZhbHVlIGNhbiBvbmx5IGJlIGFwcGVuZGVkIHRvIHByb3BlcnR5Jyk7XG4gICAgfVxuICAgIHRoaXMucXVlcnlTdHJpbmcgPSBVdGlscy5hcHBlbmRTZWdtZW50KHRoaXMucXVlcnlTdHJpbmcsIE9EYXRhUXVlcnkuJFZBTFVFKTtcbiAgICB0aGlzLmFkZFNlZ21lbnQoT0RhdGFRdWVyeS5WQUxVRSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBjb3VudFNlZ21lbnQoKTogT0RhdGFRdWVyeSB7XG4gICAgVXRpbHMucmVxdWlyZU51bGxPclVuZGVmaW5lZCh0aGlzLmdldFNlZ21lbnQoT0RhdGFRdWVyeS5DT1VOVCksIE9EYXRhUXVlcnkuQ09VTlQpO1xuICAgIGlmICh0aGlzLmxhc3RTZWdtZW50ICE9PSBPRGF0YVF1ZXJ5LkVOVElUWV9TRVQgJiYgdGhpcy5sYXN0U2VnbWVudCAhPT0gT0RhdGFRdWVyeS5OQVZJR0FUSU9OX1BST1BFUlRZKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvdW50IGNhbiBvbmx5IGJlIGFwcGVuZGVkIHRvIGVudGl0eVNldCBvciBuYXZpZ2F0aW9uUHJvcGVydHknKTtcbiAgICB9XG4gICAgdGhpcy5xdWVyeVN0cmluZyA9IFV0aWxzLmFwcGVuZFNlZ21lbnQodGhpcy5xdWVyeVN0cmluZywgT0RhdGFRdWVyeS4kQ09VTlQpO1xuICAgIHRoaXMuYWRkU2VnbWVudChPRGF0YVF1ZXJ5LkNPVU5UKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGZ1bmN0aW9uQ2FsbChmdW5jdGlvbkNhbGw6IHN0cmluZyk6IE9EYXRhUXVlcnkge1xuICAgIFV0aWxzLnJlcXVpcmVOb3ROdWxsTm9yVW5kZWZpbmVkKGZ1bmN0aW9uQ2FsbCwgJ2Z1bmN0aW9uQ2FsbCcpO1xuICAgIFV0aWxzLnJlcXVpcmVOb3RFbXB0eShmdW5jdGlvbkNhbGwsICdmdW5jdGlvbkNhbGwnKTtcbiAgICB0aGlzLnF1ZXJ5U3RyaW5nID0gVXRpbHMuYXBwZW5kU2VnbWVudCh0aGlzLnF1ZXJ5U3RyaW5nLCBmdW5jdGlvbkNhbGwpO1xuICAgIHRoaXMuYWRkU2VnbWVudChPRGF0YVF1ZXJ5LkZVTkNUSU9OX0NBTEwpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYWN0aW9uQ2FsbChhY3Rpb25DYWxsOiBzdHJpbmcpOiBPRGF0YVF1ZXJ5IHtcbiAgICBVdGlscy5yZXF1aXJlTm90TnVsbE5vclVuZGVmaW5lZChhY3Rpb25DYWxsLCAnYWN0aW9uQ2FsbCcpO1xuICAgIFV0aWxzLnJlcXVpcmVOb3RFbXB0eShhY3Rpb25DYWxsLCAnYWN0aW9uQ2FsbCcpO1xuICAgIHRoaXMucXVlcnlTdHJpbmcgPSBVdGlscy5hcHBlbmRTZWdtZW50KHRoaXMucXVlcnlTdHJpbmcsIGFjdGlvbkNhbGwpO1xuICAgIHRoaXMuYWRkU2VnbWVudChPRGF0YVF1ZXJ5LkFDVElPTl9DQUxMKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGJhdGNoKCk6IE9EYXRhUXVlcnlCYXRjaCB7XG4gICAgcmV0dXJuIG5ldyBPRGF0YVF1ZXJ5QmF0Y2godGhpcy5vZGF0YVNlcnZpY2UsIHRoaXMuc2VydmljZVJvb3QpO1xuICB9XG5cbiAgLy8gUVVFUlkgT1BUSU9OU1xuXG4gIHNlbGVjdChzZWxlY3Q6IHN0cmluZyB8IHN0cmluZ1tdKTogT0RhdGFRdWVyeSB7XG4gICAgdGhpcy5xdWVyeU9wdGlvbnMuc2VsZWN0KHNlbGVjdCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBmaWx0ZXIoZmlsdGVyOiBzdHJpbmcgfCBGaWx0ZXIpOiBPRGF0YVF1ZXJ5IHtcbiAgICB0aGlzLnF1ZXJ5T3B0aW9ucy5maWx0ZXIoZmlsdGVyKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGV4cGFuZChleHBhbmQ6IHN0cmluZyB8IEV4cGFuZCB8IEV4cGFuZFtdKTogT0RhdGFRdWVyeSB7XG4gICAgdGhpcy5xdWVyeU9wdGlvbnMuZXhwYW5kKGV4cGFuZCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBvcmRlcmJ5KG9yZGVyYnk6IHN0cmluZyB8IE9yZGVyYnlbXSk6IE9EYXRhUXVlcnkge1xuICAgIHRoaXMucXVlcnlPcHRpb25zLm9yZGVyYnkob3JkZXJieSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzZWFyY2goc2VhcmNoOiBzdHJpbmcgfCBTZWFyY2gpOiBPRGF0YVF1ZXJ5IHtcbiAgICB0aGlzLnF1ZXJ5T3B0aW9ucy5zZWFyY2goc2VhcmNoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNraXAoc2tpcDogbnVtYmVyKTogT0RhdGFRdWVyeSB7XG4gICAgdGhpcy5xdWVyeU9wdGlvbnMuc2tpcChza2lwKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHRvcCh0b3A6IG51bWJlcik6IE9EYXRhUXVlcnkge1xuICAgIHRoaXMucXVlcnlPcHRpb25zLnRvcCh0b3ApO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgY291bnRPcHRpb24oY291bnQ6IGJvb2xlYW4pOiBPRGF0YVF1ZXJ5IHtcbiAgICB0aGlzLnF1ZXJ5T3B0aW9ucy5jb3VudChjb3VudCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBjdXN0b21PcHRpb24oa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpIHtcbiAgICB0aGlzLnF1ZXJ5T3B0aW9ucy5jdXN0b21PcHRpb24oa2V5LCB2YWx1ZSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBmb3JtYXQoZm9ybWF0OiBzdHJpbmcpOiBPRGF0YVF1ZXJ5IHtcbiAgICB0aGlzLnF1ZXJ5T3B0aW9ucy5mb3JtYXQoZm9ybWF0KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8vIFFVRVJZIEVYRUNVVElPTlxuXG4gIGdldChodHRwT3B0aW9ucz86IEh0dHBPcHRpb25zSSk6IE9ic2VydmFibGU8T0RhdGFSZXNwb25zZT4ge1xuICAgIHJldHVybiB0aGlzLm9kYXRhU2VydmljZS5nZXQodGhpcywgaHR0cE9wdGlvbnMpO1xuICB9XG5cbiAgcG9zdChib2R5OiBhbnksIGh0dHBPcHRpb25zPzogSHR0cE9wdGlvbnNJKTogT2JzZXJ2YWJsZTxPRGF0YVJlc3BvbnNlPiB7XG4gICAgcmV0dXJuIHRoaXMub2RhdGFTZXJ2aWNlLnBvc3QodGhpcywgYm9keSwgaHR0cE9wdGlvbnMpO1xuICB9XG5cbiAgcGF0Y2goYm9keTogYW55LCBldGFnPzogc3RyaW5nLCBodHRwT3B0aW9ucz86IEh0dHBPcHRpb25zSSk6IE9ic2VydmFibGU8T0RhdGFSZXNwb25zZT4ge1xuICAgIHJldHVybiB0aGlzLm9kYXRhU2VydmljZS5wYXRjaCh0aGlzLCBib2R5LCBldGFnLCBodHRwT3B0aW9ucyk7XG4gIH1cblxuICBwdXQoYm9keTogYW55LCBldGFnPzogc3RyaW5nLCBodHRwT3B0aW9ucz86IEh0dHBPcHRpb25zSSk6IE9ic2VydmFibGU8T0RhdGFSZXNwb25zZT4ge1xuICAgIHJldHVybiB0aGlzLm9kYXRhU2VydmljZS5wdXQodGhpcywgYm9keSwgZXRhZywgaHR0cE9wdGlvbnMpO1xuICB9XG5cbiAgZGVsZXRlKGV0YWc/OiBzdHJpbmcsIGh0dHBPcHRpb25zPzogSHR0cE9wdGlvbnNJKTogT2JzZXJ2YWJsZTxPRGF0YVJlc3BvbnNlPiB7XG4gICAgcmV0dXJuIHRoaXMub2RhdGFTZXJ2aWNlLmRlbGV0ZSh0aGlzLCBldGFnLCBodHRwT3B0aW9ucyk7XG4gIH1cblxuICB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgIGxldCByZXM6IHN0cmluZyA9IHRoaXMucXVlcnlTdHJpbmc7XG4gICAgaWYgKFV0aWxzLmlzTm90TnVsbE5vclVuZGVmaW5lZCh0aGlzLnF1ZXJ5T3B0aW9ucykgJiYgIXRoaXMucXVlcnlPcHRpb25zLmlzRW1wdHkoKSkge1xuICAgICAgcmVzICs9ICc/JyArIHRoaXMucXVlcnlPcHRpb25zLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIHJldHVybiByZXM7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0U2VnbWVudChzZWdtZW50OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIFV0aWxzLnJlcXVpcmVOb3ROdWxsKHNlZ21lbnQsICdzZWdtZW50Jyk7XG4gICAgY29uc3QgcmVzOiBzdHJpbmcgPSB0aGlzLnNlZ21lbnRzLmZpbmQoKHZhbHVlOiBzdHJpbmcsIGluZGV4OiBudW1iZXIsIHNlZ21lbnRzOiBzdHJpbmdbXSkgPT4ge1xuICAgICAgcmV0dXJuIHZhbHVlID09PSBzZWdtZW50O1xuICAgIH0pO1xuICAgIHJldHVybiByZXM7XG4gIH1cblxuICBwcm90ZWN0ZWQgYWRkU2VnbWVudChzZWdtZW50OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBVdGlscy5yZXF1aXJlTm90TnVsbChzZWdtZW50LCAnc2VnbWVudCcpO1xuICAgIHRoaXMuc2VnbWVudHMucHVzaChzZWdtZW50KTtcbiAgICBpZiAoVXRpbHMuaXNOb3ROdWxsTm9yVW5kZWZpbmVkKHRoaXMuc2VnbWVudHMpICYmIHRoaXMuc2VnbWVudHMubGVuZ3RoKSB7XG4gICAgICB0aGlzLmxhc3RTZWdtZW50ID0gdGhpcy5zZWdtZW50c1t0aGlzLnNlZ21lbnRzLmxlbmd0aCAtIDFdO1xuICAgIH1cbiAgfVxufVxuIl19