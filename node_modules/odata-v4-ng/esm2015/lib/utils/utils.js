/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { OperatorLogical } from '../query-options/operator';
import { QuotedString } from '../odata-query/quoted-string';
export class Utils {
    /**
     * @param {?} value
     * @return {?}
     */
    static isNull(value) {
        return value === null;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    static isUndefined(value) {
        return value === undefined;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    static isNullOrUndefined(value) {
        return Utils.isNull(value) || Utils.isUndefined(value);
    }
    /**
     * @param {?} value
     * @return {?}
     */
    static isNotNullNorUndefined(value) {
        return !Utils.isNull(value) && !Utils.isUndefined(value);
    }
    /**
     * @param {?} value
     * @return {?}
     */
    static isEmpty(value) {
        if (Utils.isNullOrUndefined(value)
            || typeof (value) === 'string' && !value.length
            || value instanceof Array && !value.length
            || typeof (value.isEmpty) === 'function' && value.isEmpty()) {
            return true;
        }
        if (value instanceof Array && value) {
            for (const v of value) {
                if (!Utils.isEmpty(v)) {
                    return false;
                }
            }
            return true;
        }
        return false;
    }
    /**
     * @param {?} fieldValue
     * @param {?} fieldName
     * @return {?}
     */
    static requireNull(fieldValue, fieldName) {
        if (fieldValue !== null) {
            throw new Error(fieldName + ' must be null');
        }
    }
    /**
     * @param {?} fieldValue
     * @param {?} fieldName
     * @return {?}
     */
    static requireUndefined(fieldValue, fieldName) {
        if (fieldValue !== undefined) {
            throw new Error(fieldName + ' must be undefined');
        }
    }
    /**
     * @param {?} fieldValue
     * @param {?} fieldName
     * @return {?}
     */
    static requireNotNull(fieldValue, fieldName) {
        if (fieldValue === null) {
            throw new Error(fieldName + ' cannot be null');
        }
    }
    /**
     * @param {?} fieldValue
     * @param {?} fieldName
     * @return {?}
     */
    static requireNotUndefined(fieldValue, fieldName) {
        if (fieldValue === undefined) {
            throw new Error(fieldName + ' cannot be undefined');
        }
    }
    /**
     * @param {?} fieldValue
     * @param {?} fieldName
     * @return {?}
     */
    static requireNotNullNorUndefined(fieldValue, fieldName) {
        Utils.requireNotNull(fieldValue, fieldName);
        Utils.requireNotUndefined(fieldValue, fieldName);
    }
    /**
     * @param {?} fieldValue
     * @param {?} fieldName
     * @return {?}
     */
    static requireNullOrUndefined(fieldValue, fieldName) {
        if (!Utils.isNull(fieldValue) && !Utils.isUndefined(fieldValue)) {
            throw new Error(fieldName + ' must be null or undefined');
        }
    }
    /**
     * @param {?} fieldValue
     * @param {?} fieldName
     * @return {?}
     */
    static requireNotEmpty(fieldValue, fieldName) {
        if (Utils.isEmpty(fieldValue)) {
            throw new Error(fieldName + ' cannot be empty');
        }
    }
    /**
     * @param {?} fieldValue
     * @param {?} fieldName
     * @return {?}
     */
    static requireNotNegative(fieldValue, fieldName) {
        if (fieldValue < 0) {
            throw new Error(fieldName + ' cannot be negative');
        }
    }
    /**
     * @param {?} path
     * @param {?} segment
     * @return {?}
     */
    static appendSegment(path, segment) {
        Utils.requireNotNullNorUndefined(path, 'path');
        Utils.requireNotNullNorUndefined(segment, 'segment');
        if (!path.endsWith('/')) {
            path += '/';
        }
        return path + segment;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    static removeEndingSeparator(value) {
        Utils.requireNotNullNorUndefined(value, 'value');
        if (value.endsWith('/')) {
            if (value.length === 1) {
                return '';
            }
            return value.substring(0, value.length - 1);
        }
        return value;
    }
    /**
     * @param {?} value
     * @param {?} encodeURI
     * @return {?}
     */
    static getValueURI(value, encodeURI) {
        Utils.requireNotUndefined(value, 'value');
        Utils.requireNotNullNorUndefined(encodeURI, 'encodeURI');
        /** @type {?} */
        let res = value;
        if (typeof (res) === 'string') {
            // encode uri component
            if (Utils.isNotNullNorUndefined(encodeURI) && encodeURI) {
                res = encodeURIComponent(res);
            }
        }
        else if (res instanceof QuotedString) {
            // escape single quote
            res = res.toString().replace(/'/g, '\'\'');
            // encode uri component
            if (Utils.isNotNullNorUndefined(encodeURI) && encodeURI) {
                res = encodeURIComponent(res);
            }
            // add start/ending quotes
            res = '\'' + res + '\'';
        }
        // boolean, number
        return res;
    }
    /**
     * @param {?} items
     * @param {?=} operator
     * @param {?=} operatorUppercase
     * @return {?}
     */
    static toString(items, operator, operatorUppercase = false) {
        /** @type {?} */
        let res = '';
        if (Utils.isNullOrUndefined(items) || !items.length) {
            return res;
        }
        for (const item of items) {
            if (res.length) {
                if (Utils.isNotNullNorUndefined(operator)) {
                    /** @type {?} */
                    const operatorString = Utils.getOperatorString(operator, operatorUppercase);
                    res += ` ${operatorString} `;
                }
                else {
                    res += ',';
                }
            }
            if (Utils.isNotNullNorUndefined(operator) && operator === OperatorLogical.NOT) {
                /** @type {?} */
                const operatorString = Utils.getOperatorString(operator, operatorUppercase);
                res += `${operatorString} `;
            }
            res += item;
        }
        if (Utils.isNotNullNorUndefined(operator)) {
            return `(${res})`;
        }
        return res;
    }
    /**
     * @param {?} operator
     * @param {?} operatorUppercase
     * @return {?}
     */
    static getOperatorString(operator, operatorUppercase) {
        /** @type {?} */
        let operatorString = OperatorLogical[operator].toLowerCase();
        if (Utils.isNotNullNorUndefined(operatorUppercase) && operatorUppercase) {
            operatorString = operatorString.toUpperCase();
        }
        return operatorString;
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9vZGF0YS12NC1uZy8iLCJzb3VyY2VzIjpbImxpYi91dGlscy91dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRTVELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUU1RCxNQUFNOzs7OztJQUNGLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBVTtRQUNwQixNQUFNLENBQUMsS0FBSyxLQUFLLElBQUksQ0FBQztLQUN6Qjs7Ozs7SUFFRCxNQUFNLENBQUMsV0FBVyxDQUFDLEtBQVU7UUFDekIsTUFBTSxDQUFDLEtBQUssS0FBSyxTQUFTLENBQUM7S0FDOUI7Ozs7O0lBRUQsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEtBQVU7UUFDL0IsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUMxRDs7Ozs7SUFFRCxNQUFNLENBQUMscUJBQXFCLENBQUMsS0FBVTtRQUNuQyxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUM1RDs7Ozs7SUFFRCxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQVU7UUFDckIsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQztlQUMzQixPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssUUFBUSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU07ZUFDNUMsS0FBSyxZQUFZLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNO2VBQ3ZDLE9BQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssVUFBVSxJQUFJLEtBQUssQ0FBQyxPQUFPLEVB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QkFDaEM7Z0JBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ0osR0FBRyxJQUFJLEdBQUcsQ0FBQztpQkFDZDthQUNKO1lBQ0QsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxJQUFJLFFBQVEsS0FBSyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQzs7Z0JBQzVFLE1BQU0sY0FBYyxHQUFXLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztnQkFDcEYsR0FBRyxJQUFJLEdBQUcsY0FBYyxHQUFHLENBQUM7YUFDL0I7WUFFRCxHQUFHLElBQUksSUFBSSxDQUFDO1NBQ2Y7UUFFRCxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDO1NBQ3JCO1FBRUQsTUFBTSxDQUFDLEdBQUcsQ0FBQztLQUNkOzs7Ozs7SUFFUyxNQUFNLENBQUMsaUJBQWlCLENBQUMsUUFBeUIsRUFBRSxpQkFBMEI7O1FBQ3BGLElBQUksY0FBYyxHQUFXLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNyRSxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsaUJBQWlCLENBQUMsSUFBSSxpQkFBaUIsQ0FBQyxDQUFDLENBQUM7WUFDdEUsY0FBYyxHQUFHLGNBQWMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztTQUNqRDtRQUNELE1BQU0sQ0FBQyxjQUFjLENBQUM7S0FDekI7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9wZXJhdG9yTG9naWNhbCB9IGZyb20gJy4uL3F1ZXJ5LW9wdGlvbnMvb3BlcmF0b3InO1xuXG5pbXBvcnQgeyBRdW90ZWRTdHJpbmcgfSBmcm9tICcuLi9vZGF0YS1xdWVyeS9xdW90ZWQtc3RyaW5nJztcblxuZXhwb3J0IGNsYXNzIFV0aWxzIHtcbiAgICBzdGF0aWMgaXNOdWxsKHZhbHVlOiBhbnkpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlID09PSBudWxsO1xuICAgIH1cblxuICAgIHN0YXRpYyBpc1VuZGVmaW5lZCh2YWx1ZTogYW55KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHN0YXRpYyBpc051bGxPclVuZGVmaW5lZCh2YWx1ZTogYW55KTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBVdGlscy5pc051bGwodmFsdWUpIHx8IFV0aWxzLmlzVW5kZWZpbmVkKHZhbHVlKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgaXNOb3ROdWxsTm9yVW5kZWZpbmVkKHZhbHVlOiBhbnkpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICFVdGlscy5pc051bGwodmFsdWUpICYmICFVdGlscy5pc1VuZGVmaW5lZCh2YWx1ZSk7XG4gICAgfVxuXG4gICAgc3RhdGljIGlzRW1wdHkodmFsdWU6IGFueSk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAoVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQodmFsdWUpXG4gICAgICAgICAgICB8fCB0eXBlb2YgKHZhbHVlKSA9PT0gJ3N0cmluZycgJiYgIXZhbHVlLmxlbmd0aFxuICAgICAgICAgICAgfHwgdmFsdWUgaW5zdGFuY2VvZiBBcnJheSAmJiAhdmFsdWUubGVuZ3RoXG4gICAgICAgICAgICB8fCB0eXBlb2YgKHZhbHVlLmlzRW1wdHkpID09PSAnZnVuY3Rpb24nICYmIHZhbHVlLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXkgJiYgdmFsdWUpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgdiBvZiB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICghVXRpbHMuaXNFbXB0eSh2KSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHN0YXRpYyByZXF1aXJlTnVsbChmaWVsZFZhbHVlOiBhbnksIGZpZWxkTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIGlmIChmaWVsZFZhbHVlICE9PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZmllbGROYW1lICsgJyBtdXN0IGJlIG51bGwnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyByZXF1aXJlVW5kZWZpbmVkKGZpZWxkVmFsdWU6IGFueSwgZmllbGROYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKGZpZWxkVmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZpZWxkTmFtZSArICcgbXVzdCBiZSB1bmRlZmluZWQnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyByZXF1aXJlTm90TnVsbChmaWVsZFZhbHVlOiBhbnksIGZpZWxkTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIGlmIChmaWVsZFZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZmllbGROYW1lICsgJyBjYW5ub3QgYmUgbnVsbCcpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIHJlcXVpcmVOb3RVbmRlZmluZWQoZmllbGRWYWx1ZTogYW55LCBmaWVsZE5hbWU6IHN0cmluZykge1xuICAgICAgICBpZiAoZmllbGRWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZmllbGROYW1lICsgJyBjYW5ub3QgYmUgdW5kZWZpbmVkJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgcmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQoZmllbGRWYWx1ZTogYW55LCBmaWVsZE5hbWU6IHN0cmluZykge1xuICAgICAgICBVdGlscy5yZXF1aXJlTm90TnVsbChmaWVsZFZhbHVlLCBmaWVsZE5hbWUpO1xuICAgICAgICBVdGlscy5yZXF1aXJlTm90VW5kZWZpbmVkKGZpZWxkVmFsdWUsIGZpZWxkTmFtZSk7XG4gICAgfVxuXG4gICAgc3RhdGljIHJlcXVpcmVOdWxsT3JVbmRlZmluZWQoZmllbGRWYWx1ZTogYW55LCBmaWVsZE5hbWU6IHN0cmluZykge1xuICAgICAgICBpZiAoIVV0aWxzLmlzTnVsbChmaWVsZFZhbHVlKSAmJiAhVXRpbHMuaXNVbmRlZmluZWQoZmllbGRWYWx1ZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmaWVsZE5hbWUgKyAnIG11c3QgYmUgbnVsbCBvciB1bmRlZmluZWQnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyByZXF1aXJlTm90RW1wdHkoZmllbGRWYWx1ZTogYW55LCBmaWVsZE5hbWU6IHN0cmluZykge1xuICAgICAgICBpZiAoVXRpbHMuaXNFbXB0eShmaWVsZFZhbHVlKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZpZWxkTmFtZSArICcgY2Fubm90IGJlIGVtcHR5Jyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgcmVxdWlyZU5vdE5lZ2F0aXZlKGZpZWxkVmFsdWU6IG51bWJlciwgZmllbGROYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKGZpZWxkVmFsdWUgPCAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZmllbGROYW1lICsgJyBjYW5ub3QgYmUgbmVnYXRpdmUnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBhcHBlbmRTZWdtZW50KHBhdGg6IHN0cmluZywgc2VnbWVudDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQocGF0aCwgJ3BhdGgnKTtcbiAgICAgICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQoc2VnbWVudCwgJ3NlZ21lbnQnKTtcbiAgICAgICAgaWYgKCFwYXRoLmVuZHNXaXRoKCcvJykpIHtcbiAgICAgICAgICAgIHBhdGggKz0gJy8nO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXRoICsgc2VnbWVudDtcbiAgICB9XG5cbiAgICBzdGF0aWMgcmVtb3ZlRW5kaW5nU2VwYXJhdG9yKHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBVdGlscy5yZXF1aXJlTm90TnVsbE5vclVuZGVmaW5lZCh2YWx1ZSwgJ3ZhbHVlJyk7XG4gICAgICAgIGlmICh2YWx1ZS5lbmRzV2l0aCgnLycpKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnN1YnN0cmluZygwLCB2YWx1ZS5sZW5ndGggLSAxKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldFZhbHVlVVJJKHZhbHVlOiBib29sZWFuIHwgbnVtYmVyIHwgc3RyaW5nIHwgUXVvdGVkU3RyaW5nLCBlbmNvZGVVUkk6IGJvb2xlYW4pOiBhbnkge1xuICAgICAgICBVdGlscy5yZXF1aXJlTm90VW5kZWZpbmVkKHZhbHVlLCAndmFsdWUnKTtcbiAgICAgICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQoZW5jb2RlVVJJLCAnZW5jb2RlVVJJJyk7XG5cbiAgICAgICAgbGV0IHJlczogYW55ID0gdmFsdWU7XG5cbiAgICAgICAgaWYgKHR5cGVvZiAocmVzKSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIC8vIGVuY29kZSB1cmkgY29tcG9uZW50XG4gICAgICAgICAgICBpZiAoVXRpbHMuaXNOb3ROdWxsTm9yVW5kZWZpbmVkKGVuY29kZVVSSSkgJiYgZW5jb2RlVVJJKSB7XG4gICAgICAgICAgICAgICAgcmVzID0gZW5jb2RlVVJJQ29tcG9uZW50KHJlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAocmVzIGluc3RhbmNlb2YgUXVvdGVkU3RyaW5nKSB7XG4gICAgICAgICAgICAvLyBlc2NhcGUgc2luZ2xlIHF1b3RlXG4gICAgICAgICAgICByZXMgPSByZXMudG9TdHJpbmcoKS5yZXBsYWNlKC8nL2csICdcXCdcXCcnKTtcblxuICAgICAgICAgICAgLy8gZW5jb2RlIHVyaSBjb21wb25lbnRcbiAgICAgICAgICAgIGlmIChVdGlscy5pc05vdE51bGxOb3JVbmRlZmluZWQoZW5jb2RlVVJJKSAmJiBlbmNvZGVVUkkpIHtcbiAgICAgICAgICAgICAgICByZXMgPSBlbmNvZGVVUklDb21wb25lbnQocmVzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gYWRkIHN0YXJ0L2VuZGluZyBxdW90ZXNcbiAgICAgICAgICAgIHJlcyA9ICdcXCcnICsgcmVzICsgJ1xcJyc7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBib29sZWFuLCBudW1iZXJcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICB9XG5cbiAgICBzdGF0aWMgdG9TdHJpbmcoaXRlbXM6IGFueVtdLCBvcGVyYXRvcj86IE9wZXJhdG9yTG9naWNhbCwgb3BlcmF0b3JVcHBlcmNhc2U6IGJvb2xlYW4gPSBmYWxzZSk6IHN0cmluZyB7XG4gICAgICAgIGxldCByZXMgPSAnJztcbiAgICAgICAgaWYgKFV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKGl0ZW1zKSB8fCAhaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKSB7XG4gICAgICAgICAgICBpZiAocmVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGlmIChVdGlscy5pc05vdE51bGxOb3JVbmRlZmluZWQob3BlcmF0b3IpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wZXJhdG9yU3RyaW5nOiBzdHJpbmcgPSBVdGlscy5nZXRPcGVyYXRvclN0cmluZyhvcGVyYXRvciwgb3BlcmF0b3JVcHBlcmNhc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXMgKz0gYCAke29wZXJhdG9yU3RyaW5nfSBgO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcyArPSAnLCc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKFV0aWxzLmlzTm90TnVsbE5vclVuZGVmaW5lZChvcGVyYXRvcikgJiYgb3BlcmF0b3IgPT09IE9wZXJhdG9yTG9naWNhbC5OT1QpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBvcGVyYXRvclN0cmluZzogc3RyaW5nID0gVXRpbHMuZ2V0T3BlcmF0b3JTdHJpbmcob3BlcmF0b3IsIG9wZXJhdG9yVXBwZXJjYXNlKTtcbiAgICAgICAgICAgICAgICByZXMgKz0gYCR7b3BlcmF0b3JTdHJpbmd9IGA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlcyArPSBpdGVtO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFV0aWxzLmlzTm90TnVsbE5vclVuZGVmaW5lZChvcGVyYXRvcikpIHtcbiAgICAgICAgICAgIHJldHVybiBgKCR7cmVzfSlgO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgc3RhdGljIGdldE9wZXJhdG9yU3RyaW5nKG9wZXJhdG9yOiBPcGVyYXRvckxvZ2ljYWwsIG9wZXJhdG9yVXBwZXJjYXNlOiBib29sZWFuKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IG9wZXJhdG9yU3RyaW5nOiBzdHJpbmcgPSBPcGVyYXRvckxvZ2ljYWxbb3BlcmF0b3JdLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGlmIChVdGlscy5pc05vdE51bGxOb3JVbmRlZmluZWQob3BlcmF0b3JVcHBlcmNhc2UpICYmIG9wZXJhdG9yVXBwZXJjYXNlKSB7XG4gICAgICAgICAgICBvcGVyYXRvclN0cmluZyA9IG9wZXJhdG9yU3RyaW5nLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG9wZXJhdG9yU3RyaW5nO1xuICAgIH1cbn1cbiJdfQ==