/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Utils } from '../../utils/utils';
import { Filter } from './filter';
import { FilterHasFilter } from './filter-has-filter';
import { FilterHasProperty } from './filter-has-property';
/** @enum {number} */
const LambdaOperator = {
    ANY: 0, ALL: 1,
};
export { LambdaOperator };
LambdaOperator[LambdaOperator.ANY] = 'ANY';
LambdaOperator[LambdaOperator.ALL] = 'ALL';
/** @enum {number} */
const LambdaCollection = {
    PROPERTY_COLLECTION: 0, ENTITY_SET: 1,
};
export { LambdaCollection };
LambdaCollection[LambdaCollection.PROPERTY_COLLECTION] = 'PROPERTY_COLLECTION';
LambdaCollection[LambdaCollection.ENTITY_SET] = 'ENTITY_SET';
export class FilterLambda extends FilterHasFilter {
    /**
     * @param {?} lambdaCollection
     * @param {?} propertyOrEntitySet
     * @param {?} lambdaOperator
     * @param {?} filter
     */
    constructor(lambdaCollection, propertyOrEntitySet, lambdaOperator, filter) {
        super(filter);
        Utils.requireNotNullNorUndefined(lambdaCollection, 'lambdaCollection');
        Utils.requireNotNullNorUndefined(propertyOrEntitySet, 'propertyOrEntitySet');
        Utils.requireNotNullNorUndefined(lambdaOperator, 'lambdaOperator');
        Utils.requireNotNullNorUndefined(filter, 'filter');
        if (lambdaCollection === LambdaCollection.PROPERTY_COLLECTION) {
            this.checkProperty(propertyOrEntitySet, filter);
        }
        this.lambdaCollection = lambdaCollection;
        this.propertyOrEntitySet = propertyOrEntitySet;
        this.lambdaOperator = lambdaOperator;
    }
    /**
     * @return {?}
     */
    toString() {
        switch (this.lambdaCollection) {
            case LambdaCollection.PROPERTY_COLLECTION:
                this.replaceProperty(this.filter);
                return `${this.propertyOrEntitySet}/${LambdaOperator[this.lambdaOperator].toLowerCase()}(x:${this.filter.toString()})`;
            case LambdaCollection.ENTITY_SET:
                return `${this.propertyOrEntitySet}/${LambdaOperator[this.lambdaOperator].toLowerCase()}(x:x/${this.filter.toString()})`;
            default:
                throw new Error('unknown lambdaCollection: ' + this.lambdaCollection);
        }
    }
    /**
     * @return {?}
     */
    isEmpty() {
        if (Utils.isNullOrUndefined(this.lambdaCollection)
            && Utils.isNullOrUndefined(this.propertyOrEntitySet)
            && Utils.isNullOrUndefined(this.lambdaOperator)
            && Utils.isNullOrUndefined(this.filter)) {
            return true;
        }
        if (Utils.isNullOrUndefined(this.propertyOrEntitySet)
            && Utils.isNotNullNorUndefined(this.filter) && Utils.isEmpty(this.filter)) {
            return true;
        }
        if (Utils.isNullOrUndefined(this.filter)
            && Utils.isNotNullNorUndefined(this.propertyOrEntitySet) && !this.propertyOrEntitySet.length) {
            return true;
        }
        if (Utils.isNotNullNorUndefined(this.propertyOrEntitySet) && !this.propertyOrEntitySet.length
            && Utils.isNotNullNorUndefined(this.filter) && Utils.isEmpty(this.filter)) {
            return true;
        }
        return false;
    }
    /**
     * @param {?} propertyOrEntitySet
     * @param {?} filter
     * @return {?}
     */
    checkProperty(propertyOrEntitySet, filter) {
        if (Utils.isNullOrUndefined(filter)) {
            return;
        }
        if (filter instanceof FilterHasProperty) {
            if (propertyOrEntitySet !== filter.getProperty()) {
                throw new Error('lambda property to filter must match inner filters property');
            }
        }
        if (filter instanceof FilterHasFilter) {
            /** @type {?} */
            const filterChild = filter.getFilter();
            if (filterChild instanceof Filter) {
                this.replaceProperty(filterChild);
            }
            else {
                for (const f of filterChild) {
                    this.replaceProperty(f);
                }
            }
        }
    }
    /**
     * @param {?} filter
     * @return {?}
     */
    replaceProperty(filter) {
        if (Utils.isNullOrUndefined(filter)) {
            return;
        }
        if (filter instanceof FilterHasProperty) {
            filter.setProperty('x');
        }
        if (filter instanceof FilterHasFilter) {
            /** @type {?} */
            const filterChild = filter.getFilter();
            if (filterChild instanceof Filter) {
                this.replaceProperty(filterChild);
            }
            else {
                for (const f of filterChild) {
                    this.replaceProperty(f);
                }
            }
        }
    }
}
if (false) {
    /** @type {?} */
    FilterLambda.prototype.lambdaCollection;
    /** @type {?} */
    FilterLambda.prototype.propertyOrEntitySet;
    /** @type {?} */
    FilterLambda.prototype.lambdaOperator;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLWxhbWJkYS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL29kYXRhLXY0LW5nLyIsInNvdXJjZXMiOlsibGliL3F1ZXJ5LW9wdGlvbnMvZmlsdGVyL2ZpbHRlci1sYW1iZGEudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUMxQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQ2xDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQzs7O0lBR3RELE1BQUcsRUFBRSxNQUFHOzs7OEJBQVIsR0FBRzs4QkFBRSxHQUFHOzs7SUFJUixzQkFBbUIsRUFBRSxhQUFVOzs7a0NBQS9CLG1CQUFtQjtrQ0FBRSxVQUFVO0FBR25DLE1BQU0sbUJBQW9CLFNBQVEsZUFBZTs7Ozs7OztJQUs3QyxZQUFZLGdCQUFrQyxFQUFFLG1CQUEyQixFQUFFLGNBQThCLEVBQUUsTUFBYztRQUN2SCxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDZCxLQUFLLENBQUMsMEJBQTBCLENBQUMsZ0JBQWdCLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztRQUN2RSxLQUFLLENBQUMsMEJBQTBCLENBQUMsbUJBQW1CLEVBQUUscUJBQXFCLENBQUMsQ0FBQztRQUM3RSxLQUFLLENBQUMsMEJBQTBCLENBQUMsY0FBYyxFQUFFLGdCQUFnQixDQUFDLENBQUM7UUFDbkUsS0FBSyxDQUFDLDBCQUEwQixDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztRQUNuRCxFQUFFLENBQUMsQ0FBQyxnQkFBZ0IsS0FBSyxnQkFBZ0IsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUM7WUFDNUQsSUFBSSxDQUFDLGFBQWEsQ0FBQyxtQkFBbUIsRUFBRSxNQUFNLENBQUMsQ0FBQztTQUNuRDtRQUNELElBQUksQ0FB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MUIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztpQkFDM0I7YUFDSjtTQUNKO0tBQ0o7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFV0aWxzIH0gZnJvbSAnLi4vLi4vdXRpbHMvdXRpbHMnO1xuaW1wb3J0IHsgRmlsdGVyIH0gZnJvbSAnLi9maWx0ZXInO1xuaW1wb3J0IHsgRmlsdGVySGFzRmlsdGVyIH0gZnJvbSAnLi9maWx0ZXItaGFzLWZpbHRlcic7XG5pbXBvcnQgeyBGaWx0ZXJIYXNQcm9wZXJ0eSB9IGZyb20gJy4vZmlsdGVyLWhhcy1wcm9wZXJ0eSc7XG5cbmV4cG9ydCBlbnVtIExhbWJkYU9wZXJhdG9yIHtcbiAgICBBTlksIEFMTFxufVxuXG5leHBvcnQgZW51bSBMYW1iZGFDb2xsZWN0aW9uIHtcbiAgICBQUk9QRVJUWV9DT0xMRUNUSU9OLCBFTlRJVFlfU0VUXG59XG5cbmV4cG9ydCBjbGFzcyBGaWx0ZXJMYW1iZGEgZXh0ZW5kcyBGaWx0ZXJIYXNGaWx0ZXIgaW1wbGVtZW50cyBGaWx0ZXIge1xuICAgIHByaXZhdGUgbGFtYmRhQ29sbGVjdGlvbjogTGFtYmRhQ29sbGVjdGlvbjtcbiAgICBwcml2YXRlIHByb3BlcnR5T3JFbnRpdHlTZXQ6IHN0cmluZztcbiAgICBwcml2YXRlIGxhbWJkYU9wZXJhdG9yOiBMYW1iZGFPcGVyYXRvcjtcblxuICAgIGNvbnN0cnVjdG9yKGxhbWJkYUNvbGxlY3Rpb246IExhbWJkYUNvbGxlY3Rpb24sIHByb3BlcnR5T3JFbnRpdHlTZXQ6IHN0cmluZywgbGFtYmRhT3BlcmF0b3I6IExhbWJkYU9wZXJhdG9yLCBmaWx0ZXI6IEZpbHRlcikge1xuICAgICAgICBzdXBlcihmaWx0ZXIpO1xuICAgICAgICBVdGlscy5yZXF1aXJlTm90TnVsbE5vclVuZGVmaW5lZChsYW1iZGFDb2xsZWN0aW9uLCAnbGFtYmRhQ29sbGVjdGlvbicpO1xuICAgICAgICBVdGlscy5yZXF1aXJlTm90TnVsbE5vclVuZGVmaW5lZChwcm9wZXJ0eU9yRW50aXR5U2V0LCAncHJvcGVydHlPckVudGl0eVNldCcpO1xuICAgICAgICBVdGlscy5yZXF1aXJlTm90TnVsbE5vclVuZGVmaW5lZChsYW1iZGFPcGVyYXRvciwgJ2xhbWJkYU9wZXJhdG9yJyk7XG4gICAgICAgIFV0aWxzLnJlcXVpcmVOb3ROdWxsTm9yVW5kZWZpbmVkKGZpbHRlciwgJ2ZpbHRlcicpO1xuICAgICAgICBpZiAobGFtYmRhQ29sbGVjdGlvbiA9PT0gTGFtYmRhQ29sbGVjdGlvbi5QUk9QRVJUWV9DT0xMRUNUSU9OKSB7XG4gICAgICAgICAgICB0aGlzLmNoZWNrUHJvcGVydHkocHJvcGVydHlPckVudGl0eVNldCwgZmlsdGVyKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxhbWJkYUNvbGxlY3Rpb24gPSBsYW1iZGFDb2xsZWN0aW9uO1xuICAgICAgICB0aGlzLnByb3BlcnR5T3JFbnRpdHlTZXQgPSBwcm9wZXJ0eU9yRW50aXR5U2V0O1xuICAgICAgICB0aGlzLmxhbWJkYU9wZXJhdG9yID0gbGFtYmRhT3BlcmF0b3I7XG4gICAgfVxuXG4gICAgdG9TdHJpbmcoKTogc3RyaW5nIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLmxhbWJkYUNvbGxlY3Rpb24pIHtcbiAgICAgICAgICAgIGNhc2UgTGFtYmRhQ29sbGVjdGlvbi5QUk9QRVJUWV9DT0xMRUNUSU9OOlxuICAgICAgICAgICAgICAgIHRoaXMucmVwbGFjZVByb3BlcnR5KHRoaXMuZmlsdGVyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7dGhpcy5wcm9wZXJ0eU9yRW50aXR5U2V0fS8ke0xhbWJkYU9wZXJhdG9yW3RoaXMubGFtYmRhT3BlcmF0b3JdLnRvTG93ZXJDYXNlKCl9KHg6JHt0aGlzLmZpbHRlci50b1N0cmluZygpfSlgO1xuICAgICAgICAgICAgY2FzZSBMYW1iZGFDb2xsZWN0aW9uLkVOVElUWV9TRVQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke3RoaXMucHJvcGVydHlPckVudGl0eVNldH0vJHtMYW1iZGFPcGVyYXRvclt0aGlzLmxhbWJkYU9wZXJhdG9yXS50b0xvd2VyQ2FzZSgpfSh4OngvJHt0aGlzLmZpbHRlci50b1N0cmluZygpfSlgO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3Vua25vd24gbGFtYmRhQ29sbGVjdGlvbjogJyArIHRoaXMubGFtYmRhQ29sbGVjdGlvbik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpc0VtcHR5KCk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAoVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQodGhpcy5sYW1iZGFDb2xsZWN0aW9uKVxuICAgICAgICAgICAgJiYgVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQodGhpcy5wcm9wZXJ0eU9yRW50aXR5U2V0KVxuICAgICAgICAgICAgJiYgVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQodGhpcy5sYW1iZGFPcGVyYXRvcilcbiAgICAgICAgICAgICYmIFV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKHRoaXMuZmlsdGVyKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKHRoaXMucHJvcGVydHlPckVudGl0eVNldClcbiAgICAgICAgICAgICYmIFV0aWxzLmlzTm90TnVsbE5vclVuZGVmaW5lZCh0aGlzLmZpbHRlcikgJiYgVXRpbHMuaXNFbXB0eSh0aGlzLmZpbHRlcikpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChVdGlscy5pc051bGxPclVuZGVmaW5lZCh0aGlzLmZpbHRlcilcbiAgICAgICAgICAgICYmIFV0aWxzLmlzTm90TnVsbE5vclVuZGVmaW5lZCh0aGlzLnByb3BlcnR5T3JFbnRpdHlTZXQpICYmICF0aGlzLnByb3BlcnR5T3JFbnRpdHlTZXQubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoVXRpbHMuaXNOb3ROdWxsTm9yVW5kZWZpbmVkKHRoaXMucHJvcGVydHlPckVudGl0eVNldCkgJiYgIXRoaXMucHJvcGVydHlPckVudGl0eVNldC5sZW5ndGhcbiAgICAgICAgICAgICYmIFV0aWxzLmlzTm90TnVsbE5vclVuZGVmaW5lZCh0aGlzLmZpbHRlcikgJiYgVXRpbHMuaXNFbXB0eSh0aGlzLmZpbHRlcikpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBjaGVja1Byb3BlcnR5KHByb3BlcnR5T3JFbnRpdHlTZXQ6IHN0cmluZywgZmlsdGVyOiBGaWx0ZXIgfCBGaWx0ZXJbXSkge1xuICAgICAgICBpZiAoVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQoZmlsdGVyKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmaWx0ZXIgaW5zdGFuY2VvZiBGaWx0ZXJIYXNQcm9wZXJ0eSkge1xuICAgICAgICAgICAgaWYgKHByb3BlcnR5T3JFbnRpdHlTZXQgIT09IGZpbHRlci5nZXRQcm9wZXJ0eSgpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdsYW1iZGEgcHJvcGVydHkgdG8gZmlsdGVyIG11c3QgbWF0Y2ggaW5uZXIgZmlsdGVycyBwcm9wZXJ0eScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChmaWx0ZXIgaW5zdGFuY2VvZiBGaWx0ZXJIYXNGaWx0ZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlckNoaWxkOiBGaWx0ZXIgfCBGaWx0ZXJbXSA9IGZpbHRlci5nZXRGaWx0ZXIoKTtcbiAgICAgICAgICAgIGlmIChmaWx0ZXJDaGlsZCBpbnN0YW5jZW9mIEZpbHRlcikge1xuICAgICAgICAgICAgICAgIHRoaXMucmVwbGFjZVByb3BlcnR5KGZpbHRlckNoaWxkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBmIG9mIGZpbHRlckNoaWxkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVwbGFjZVByb3BlcnR5KGYpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCByZXBsYWNlUHJvcGVydHkoZmlsdGVyOiBGaWx0ZXIgfCBGaWx0ZXJbXSkge1xuICAgICAgICBpZiAoVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQoZmlsdGVyKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmaWx0ZXIgaW5zdGFuY2VvZiBGaWx0ZXJIYXNQcm9wZXJ0eSkge1xuICAgICAgICAgICAgZmlsdGVyLnNldFByb3BlcnR5KCd4Jyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbHRlciBpbnN0YW5jZW9mIEZpbHRlckhhc0ZpbHRlcikge1xuICAgICAgICAgICAgY29uc3QgZmlsdGVyQ2hpbGQ6IEZpbHRlciB8IEZpbHRlcltdID0gZmlsdGVyLmdldEZpbHRlcigpO1xuICAgICAgICAgICAgaWYgKGZpbHRlckNoaWxkIGluc3RhbmNlb2YgRmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXBsYWNlUHJvcGVydHkoZmlsdGVyQ2hpbGQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGYgb2YgZmlsdGVyQ2hpbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXBsYWNlUHJvcGVydHkoZik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuIl19