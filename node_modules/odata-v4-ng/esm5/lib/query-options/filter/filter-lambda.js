/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Utils } from '../../utils/utils';
import { Filter } from './filter';
import { FilterHasFilter } from './filter-has-filter';
import { FilterHasProperty } from './filter-has-property';
/** @enum {number} */
var LambdaOperator = {
    ANY: 0, ALL: 1,
};
export { LambdaOperator };
LambdaOperator[LambdaOperator.ANY] = 'ANY';
LambdaOperator[LambdaOperator.ALL] = 'ALL';
/** @enum {number} */
var LambdaCollection = {
    PROPERTY_COLLECTION: 0, ENTITY_SET: 1,
};
export { LambdaCollection };
LambdaCollection[LambdaCollection.PROPERTY_COLLECTION] = 'PROPERTY_COLLECTION';
LambdaCollection[LambdaCollection.ENTITY_SET] = 'ENTITY_SET';
var FilterLambda = /** @class */ (function (_super) {
    tslib_1.__extends(FilterLambda, _super);
    function FilterLambda(lambdaCollection, propertyOrEntitySet, lambdaOperator, filter) {
        var _this = _super.call(this, filter) || this;
        Utils.requireNotNullNorUndefined(lambdaCollection, 'lambdaCollection');
        Utils.requireNotNullNorUndefined(propertyOrEntitySet, 'propertyOrEntitySet');
        Utils.requireNotNullNorUndefined(lambdaOperator, 'lambdaOperator');
        Utils.requireNotNullNorUndefined(filter, 'filter');
        if (lambdaCollection === LambdaCollection.PROPERTY_COLLECTION) {
            _this.checkProperty(propertyOrEntitySet, filter);
        }
        _this.lambdaCollection = lambdaCollection;
        _this.propertyOrEntitySet = propertyOrEntitySet;
        _this.lambdaOperator = lambdaOperator;
        return _this;
    }
    /**
     * @return {?}
     */
    FilterLambda.prototype.toString = /**
     * @return {?}
     */
    function () {
        switch (this.lambdaCollection) {
            case LambdaCollection.PROPERTY_COLLECTION:
                this.replaceProperty(this.filter);
                return this.propertyOrEntitySet + "/" + LambdaOperator[this.lambdaOperator].toLowerCase() + "(x:" + this.filter.toString() + ")";
            case LambdaCollection.ENTITY_SET:
                return this.propertyOrEntitySet + "/" + LambdaOperator[this.lambdaOperator].toLowerCase() + "(x:x/" + this.filter.toString() + ")";
            default:
                throw new Error('unknown lambdaCollection: ' + this.lambdaCollection);
        }
    };
    /**
     * @return {?}
     */
    FilterLambda.prototype.isEmpty = /**
     * @return {?}
     */
    function () {
        if (Utils.isNullOrUndefined(this.lambdaCollection)
            && Utils.isNullOrUndefined(this.propertyOrEntitySet)
            && Utils.isNullOrUndefined(this.lambdaOperator)
            && Utils.isNullOrUndefined(this.filter)) {
            return true;
        }
        if (Utils.isNullOrUndefined(this.propertyOrEntitySet)
            && Utils.isNotNullNorUndefined(this.filter) && Utils.isEmpty(this.filter)) {
            return true;
        }
        if (Utils.isNullOrUndefined(this.filter)
            && Utils.isNotNullNorUndefined(this.propertyOrEntitySet) && !this.propertyOrEntitySet.length) {
            return true;
        }
        if (Utils.isNotNullNorUndefined(this.propertyOrEntitySet) && !this.propertyOrEntitySet.length
            && Utils.isNotNullNorUndefined(this.filter) && Utils.isEmpty(this.filter)) {
            return true;
        }
        return false;
    };
    /**
     * @param {?} propertyOrEntitySet
     * @param {?} filter
     * @return {?}
     */
    FilterLambda.prototype.checkProperty = /**
     * @param {?} propertyOrEntitySet
     * @param {?} filter
     * @return {?}
     */
    function (propertyOrEntitySet, filter) {
        if (Utils.isNullOrUndefined(filter)) {
            return;
        }
        if (filter instanceof FilterHasProperty) {
            if (propertyOrEntitySet !== filter.getProperty()) {
                throw new Error('lambda property to filter must match inner filters property');
            }
        }
        if (filter instanceof FilterHasFilter) {
            /** @type {?} */
            var filterChild = filter.getFilter();
            if (filterChild instanceof Filter) {
                this.replaceProperty(filterChild);
            }
            else {
                try {
                    for (var filterChild_1 = tslib_1.__values(filterChild), filterChild_1_1 = filterChild_1.next(); !filterChild_1_1.done; filterChild_1_1 = filterChild_1.next()) {
                        var f = filterChild_1_1.value;
                        this.replaceProperty(f);
                    }
                }
                catch (e_1_1) { e_1 = { error: e_1_1 }; }
                finally {
                    try {
                        if (filterChild_1_1 && !filterChild_1_1.done && (_a = filterChild_1.return)) _a.call(filterChild_1);
                    }
                    finally { if (e_1) throw e_1.error; }
                }
            }
        }
        var e_1, _a;
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    FilterLambda.prototype.replaceProperty = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        if (Utils.isNullOrUndefined(filter)) {
            return;
        }
        if (filter instanceof FilterHasProperty) {
            filter.setProperty('x');
        }
        if (filter instanceof FilterHasFilter) {
            /** @type {?} */
            var filterChild = filter.getFilter();
            if (filterChild instanceof Filter) {
                this.replaceProperty(filterChild);
            }
            else {
                try {
                    for (var filterChild_2 = tslib_1.__values(filterChild), filterChild_2_1 = filterChild_2.next(); !filterChild_2_1.done; filterChild_2_1 = filterChild_2.next()) {
                        var f = filterChild_2_1.value;
                        this.replaceProperty(f);
                    }
                }
                catch (e_2_1) { e_2 = { error: e_2_1 }; }
                finally {
                    try {
                        if (filterChild_2_1 && !filterChild_2_1.done && (_a = filterChild_2.return)) _a.call(filterChild_2);
                    }
                    finally { if (e_2) throw e_2.error; }
                }
            }
        }
        var e_2, _a;
    };
    return FilterLambda;
}(FilterHasFilter));
export { FilterLambda };
if (false) {
    /** @type {?} */
    FilterLambda.prototype.lambdaCollection;
    /** @type {?} */
    FilterLambda.prototype.propertyOrEntitySet;
    /** @type {?} */
    FilterLambda.prototype.lambdaOperator;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLWxhbWJkYS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL29kYXRhLXY0LW5nLyIsInNvdXJjZXMiOlsibGliL3F1ZXJ5LW9wdGlvbnMvZmlsdGVyL2ZpbHRlci1sYW1iZGEudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDMUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUNsQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7OztJQUd0RCxNQUFHLEVBQUUsTUFBRzs7OzhCQUFSLEdBQUc7OEJBQUUsR0FBRzs7O0lBSVIsc0JBQW1CLEVBQUUsYUFBVTs7O2tDQUEvQixtQkFBbUI7a0NBQUUsVUFBVTtBQUduQyxJQUFBO0lBQWtDLHdDQUFlO0lBSzdDLHNCQUFZLGdCQUFrQyxFQUFFLG1CQUEyQixFQUFFLGNBQThCLEVBQUUsTUFBYztRQUEzSCxZQUNJLGtCQUFNLE1BQU0sQ0FBQyxTQVdoQjtRQVZHLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxnQkFBZ0IsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1FBQ3ZFLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxtQkFBbUIsRUFBRSxxQkFBcUIsQ0FBQyxDQUFDO1FBQzdFLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxjQUFjLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztRQUNuRSxLQUFLLENBQUMsMEJBQTBCLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ25ELEVBQUUsQ0FBQyxDQUFDLGdCQUFnQixLQUFLLGdCQUFnQixDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQztZQUM1RCxLQUFJLENBQUMsYUFBYSxDQUFDLG1CQUFtQixFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQ25EO1FBQ0QsS0FBSSxDQUFDLGdCQUFn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R0FBRyxDQUFDLENBQVksSUFBQSxnQkFBQSxpQkFBQSxXQUFXLENBQUEsd0NBQUE7d0JBQXRCLElBQU0sQ0FBQyx3QkFBQTt3QkFDUixJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO3FCQUMzQjs7Ozs7Ozs7O2FBQ0o7U0FDSjs7S0FDSjt1QkF6R0w7RUFha0MsZUFBZSxFQTZGaEQsQ0FBQTtBQTdGRCx3QkE2RkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBVdGlscyB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWxzJztcbmltcG9ydCB7IEZpbHRlciB9IGZyb20gJy4vZmlsdGVyJztcbmltcG9ydCB7IEZpbHRlckhhc0ZpbHRlciB9IGZyb20gJy4vZmlsdGVyLWhhcy1maWx0ZXInO1xuaW1wb3J0IHsgRmlsdGVySGFzUHJvcGVydHkgfSBmcm9tICcuL2ZpbHRlci1oYXMtcHJvcGVydHknO1xuXG5leHBvcnQgZW51bSBMYW1iZGFPcGVyYXRvciB7XG4gICAgQU5ZLCBBTExcbn1cblxuZXhwb3J0IGVudW0gTGFtYmRhQ29sbGVjdGlvbiB7XG4gICAgUFJPUEVSVFlfQ09MTEVDVElPTiwgRU5USVRZX1NFVFxufVxuXG5leHBvcnQgY2xhc3MgRmlsdGVyTGFtYmRhIGV4dGVuZHMgRmlsdGVySGFzRmlsdGVyIGltcGxlbWVudHMgRmlsdGVyIHtcbiAgICBwcml2YXRlIGxhbWJkYUNvbGxlY3Rpb246IExhbWJkYUNvbGxlY3Rpb247XG4gICAgcHJpdmF0ZSBwcm9wZXJ0eU9yRW50aXR5U2V0OiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBsYW1iZGFPcGVyYXRvcjogTGFtYmRhT3BlcmF0b3I7XG5cbiAgICBjb25zdHJ1Y3RvcihsYW1iZGFDb2xsZWN0aW9uOiBMYW1iZGFDb2xsZWN0aW9uLCBwcm9wZXJ0eU9yRW50aXR5U2V0OiBzdHJpbmcsIGxhbWJkYU9wZXJhdG9yOiBMYW1iZGFPcGVyYXRvciwgZmlsdGVyOiBGaWx0ZXIpIHtcbiAgICAgICAgc3VwZXIoZmlsdGVyKTtcbiAgICAgICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQobGFtYmRhQ29sbGVjdGlvbiwgJ2xhbWJkYUNvbGxlY3Rpb24nKTtcbiAgICAgICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQocHJvcGVydHlPckVudGl0eVNldCwgJ3Byb3BlcnR5T3JFbnRpdHlTZXQnKTtcbiAgICAgICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQobGFtYmRhT3BlcmF0b3IsICdsYW1iZGFPcGVyYXRvcicpO1xuICAgICAgICBVdGlscy5yZXF1aXJlTm90TnVsbE5vclVuZGVmaW5lZChmaWx0ZXIsICdmaWx0ZXInKTtcbiAgICAgICAgaWYgKGxhbWJkYUNvbGxlY3Rpb24gPT09IExhbWJkYUNvbGxlY3Rpb24uUFJPUEVSVFlfQ09MTEVDVElPTikge1xuICAgICAgICAgICAgdGhpcy5jaGVja1Byb3BlcnR5KHByb3BlcnR5T3JFbnRpdHlTZXQsIGZpbHRlcik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sYW1iZGFDb2xsZWN0aW9uID0gbGFtYmRhQ29sbGVjdGlvbjtcbiAgICAgICAgdGhpcy5wcm9wZXJ0eU9yRW50aXR5U2V0ID0gcHJvcGVydHlPckVudGl0eVNldDtcbiAgICAgICAgdGhpcy5sYW1iZGFPcGVyYXRvciA9IGxhbWJkYU9wZXJhdG9yO1xuICAgIH1cblxuICAgIHRvU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgICAgIHN3aXRjaCAodGhpcy5sYW1iZGFDb2xsZWN0aW9uKSB7XG4gICAgICAgICAgICBjYXNlIExhbWJkYUNvbGxlY3Rpb24uUFJPUEVSVFlfQ09MTEVDVElPTjpcbiAgICAgICAgICAgICAgICB0aGlzLnJlcGxhY2VQcm9wZXJ0eSh0aGlzLmZpbHRlcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke3RoaXMucHJvcGVydHlPckVudGl0eVNldH0vJHtMYW1iZGFPcGVyYXRvclt0aGlzLmxhbWJkYU9wZXJhdG9yXS50b0xvd2VyQ2FzZSgpfSh4OiR7dGhpcy5maWx0ZXIudG9TdHJpbmcoKX0pYDtcbiAgICAgICAgICAgIGNhc2UgTGFtYmRhQ29sbGVjdGlvbi5FTlRJVFlfU0VUOlxuICAgICAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLnByb3BlcnR5T3JFbnRpdHlTZXR9LyR7TGFtYmRhT3BlcmF0b3JbdGhpcy5sYW1iZGFPcGVyYXRvcl0udG9Mb3dlckNhc2UoKX0oeDp4LyR7dGhpcy5maWx0ZXIudG9TdHJpbmcoKX0pYDtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd1bmtub3duIGxhbWJkYUNvbGxlY3Rpb246ICcgKyB0aGlzLmxhbWJkYUNvbGxlY3Rpb24pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaXNFbXB0eSgpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKFV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKHRoaXMubGFtYmRhQ29sbGVjdGlvbilcbiAgICAgICAgICAgICYmIFV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKHRoaXMucHJvcGVydHlPckVudGl0eVNldClcbiAgICAgICAgICAgICYmIFV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKHRoaXMubGFtYmRhT3BlcmF0b3IpXG4gICAgICAgICAgICAmJiBVdGlscy5pc051bGxPclVuZGVmaW5lZCh0aGlzLmZpbHRlcikpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChVdGlscy5pc051bGxPclVuZGVmaW5lZCh0aGlzLnByb3BlcnR5T3JFbnRpdHlTZXQpXG4gICAgICAgICAgICAmJiBVdGlscy5pc05vdE51bGxOb3JVbmRlZmluZWQodGhpcy5maWx0ZXIpICYmIFV0aWxzLmlzRW1wdHkodGhpcy5maWx0ZXIpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQodGhpcy5maWx0ZXIpXG4gICAgICAgICAgICAmJiBVdGlscy5pc05vdE51bGxOb3JVbmRlZmluZWQodGhpcy5wcm9wZXJ0eU9yRW50aXR5U2V0KSAmJiAhdGhpcy5wcm9wZXJ0eU9yRW50aXR5U2V0Lmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFV0aWxzLmlzTm90TnVsbE5vclVuZGVmaW5lZCh0aGlzLnByb3BlcnR5T3JFbnRpdHlTZXQpICYmICF0aGlzLnByb3BlcnR5T3JFbnRpdHlTZXQubGVuZ3RoXG4gICAgICAgICAgICAmJiBVdGlscy5pc05vdE51bGxOb3JVbmRlZmluZWQodGhpcy5maWx0ZXIpICYmIFV0aWxzLmlzRW1wdHkodGhpcy5maWx0ZXIpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgY2hlY2tQcm9wZXJ0eShwcm9wZXJ0eU9yRW50aXR5U2V0OiBzdHJpbmcsIGZpbHRlcjogRmlsdGVyIHwgRmlsdGVyW10pIHtcbiAgICAgICAgaWYgKFV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKGZpbHRlcikpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZmlsdGVyIGluc3RhbmNlb2YgRmlsdGVySGFzUHJvcGVydHkpIHtcbiAgICAgICAgICAgIGlmIChwcm9wZXJ0eU9yRW50aXR5U2V0ICE9PSBmaWx0ZXIuZ2V0UHJvcGVydHkoKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignbGFtYmRhIHByb3BlcnR5IHRvIGZpbHRlciBtdXN0IG1hdGNoIGlubmVyIGZpbHRlcnMgcHJvcGVydHknKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZmlsdGVyIGluc3RhbmNlb2YgRmlsdGVySGFzRmlsdGVyKSB7XG4gICAgICAgICAgICBjb25zdCBmaWx0ZXJDaGlsZDogRmlsdGVyIHwgRmlsdGVyW10gPSBmaWx0ZXIuZ2V0RmlsdGVyKCk7XG4gICAgICAgICAgICBpZiAoZmlsdGVyQ2hpbGQgaW5zdGFuY2VvZiBGaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlcGxhY2VQcm9wZXJ0eShmaWx0ZXJDaGlsZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZiBvZiBmaWx0ZXJDaGlsZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcGxhY2VQcm9wZXJ0eShmKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgcmVwbGFjZVByb3BlcnR5KGZpbHRlcjogRmlsdGVyIHwgRmlsdGVyW10pIHtcbiAgICAgICAgaWYgKFV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKGZpbHRlcikpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZmlsdGVyIGluc3RhbmNlb2YgRmlsdGVySGFzUHJvcGVydHkpIHtcbiAgICAgICAgICAgIGZpbHRlci5zZXRQcm9wZXJ0eSgneCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmaWx0ZXIgaW5zdGFuY2VvZiBGaWx0ZXJIYXNGaWx0ZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlckNoaWxkOiBGaWx0ZXIgfCBGaWx0ZXJbXSA9IGZpbHRlci5nZXRGaWx0ZXIoKTtcbiAgICAgICAgICAgIGlmIChmaWx0ZXJDaGlsZCBpbnN0YW5jZW9mIEZpbHRlcikge1xuICAgICAgICAgICAgICAgIHRoaXMucmVwbGFjZVByb3BlcnR5KGZpbHRlckNoaWxkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBmIG9mIGZpbHRlckNoaWxkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVwbGFjZVByb3BlcnR5KGYpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==