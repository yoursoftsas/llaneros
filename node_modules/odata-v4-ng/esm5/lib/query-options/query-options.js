/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { FilterString } from './filter/filter-string';
import { Expand } from './expand';
import { Utils } from '../utils/utils';
import { Orderby } from './orderby';
var QueryOptions = /** @class */ (function () {
    function QueryOptions(separator) {
        Utils.requireNotNullNorUndefined(separator, 'separator');
        Utils.requireNotEmpty(separator, 'separator');
        this._separator = separator;
        this._select = null;
        this._filter = null;
        this._expand = null;
        this._orderby = null;
        this._search = null;
        this._skip = null;
        this._top = null;
        this._count = null;
        this._customOptions = null;
        this._format = null;
    }
    /**
     * @param {?} select
     * @return {?}
     */
    QueryOptions.prototype.select = /**
     * @param {?} select
     * @return {?}
     */
    function (select) {
        if (Utils.isNullOrUndefined(select) || Utils.isEmpty(select)) {
            this._select = null;
        }
        else {
            this._select = typeof (select) === 'string' ? [select] : select;
        }
        return this;
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    QueryOptions.prototype.filter = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        if (Utils.isNullOrUndefined(filter) || Utils.isEmpty(filter)) {
            this._filter = null;
        }
        else {
            this._filter = typeof (filter) === 'string' ? new FilterString(filter) : filter;
        }
        return this;
    };
    /**
     * @param {?} expand
     * @return {?}
     */
    QueryOptions.prototype.expand = /**
     * @param {?} expand
     * @return {?}
     */
    function (expand) {
        if (Utils.isNullOrUndefined(expand) || Utils.isEmpty(expand)) {
            this._expand = null;
        }
        else {
            this._expand = typeof (expand) === 'string' ? [new Expand(expand)] : expand instanceof Expand ? [expand] : expand;
        }
        return this;
    };
    /**
     * @param {?} orderby
     * @return {?}
     */
    QueryOptions.prototype.orderby = /**
     * @param {?} orderby
     * @return {?}
     */
    function (orderby) {
        if (Utils.isNullOrUndefined(orderby) || Utils.isEmpty(orderby)) {
            this._orderby = null;
        }
        else {
            this._orderby = typeof (orderby) === 'string' ? [new Orderby(orderby)] : orderby;
        }
        return this;
    };
    /**
     * @param {?} search
     * @return {?}
     */
    QueryOptions.prototype.search = /**
     * @param {?} search
     * @return {?}
     */
    function (search) {
        this._search = search;
        return this;
    };
    /**
     * @param {?} skip
     * @return {?}
     */
    QueryOptions.prototype.skip = /**
     * @param {?} skip
     * @return {?}
     */
    function (skip) {
        Utils.requireNotNegative(skip, 'skip');
        this._skip = skip;
        return this;
    };
    /**
     * @param {?} top
     * @return {?}
     */
    QueryOptions.prototype.top = /**
     * @param {?} top
     * @return {?}
     */
    function (top) {
        Utils.requireNotNegative(top, 'top');
        this._top = top;
        return this;
    };
    /**
     * @param {?} count
     * @return {?}
     */
    QueryOptions.prototype.count = /**
     * @param {?} count
     * @return {?}
     */
    function (count) {
        this._count = count;
        return this;
    };
    /**
     * @param {?} format
     * @return {?}
     */
    QueryOptions.prototype.format = /**
     * @param {?} format
     * @return {?}
     */
    function (format) {
        this._format = format;
        return this;
    };
    /**
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    QueryOptions.prototype.customOption = /**
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    function (key, value) {
        Utils.requireNotNullNorUndefined(key, 'key');
        if (Utils.isNullOrUndefined(this._customOptions)) {
            this._customOptions = new Map();
        }
        this._customOptions.set(key, value);
        return this;
    };
    /**
     * @return {?}
     */
    QueryOptions.prototype.toString = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var queryOptions = '';
        // add select
        if (!Utils.isNullOrUndefined(this._select) && !Utils.isEmpty(this._select)) {
            queryOptions += '$select=';
            if (typeof (this._select) === 'string') {
                queryOptions += this._select;
            }
            else {
                queryOptions += Utils.toString(this._select);
            }
        }
        // add filter
        if (!Utils.isNullOrUndefined(this._filter) && !Utils.isEmpty(this._filter)) {
            if (queryOptions.length) {
                queryOptions += this._separator;
            }
            queryOptions += '$filter=' + encodeURIComponent(this._filter.toString());
        }
        // add expand
        if (!Utils.isNullOrUndefined(this._expand) && !Utils.isEmpty(this._expand)) {
            if (queryOptions.length) {
                queryOptions += this._separator;
            }
            queryOptions += '$expand=';
            if (typeof (this._expand) === 'string') {
                queryOptions += this._expand;
            }
            else {
                queryOptions += Utils.toString(this._expand);
            }
        }
        // add orderby
        if (!Utils.isNullOrUndefined(this._orderby) && !Utils.isEmpty(this._orderby)) {
            if (queryOptions.length) {
                queryOptions += this._separator;
            }
            queryOptions += '$orderby=';
            if (typeof (this._orderby) === 'string') {
                queryOptions += this._orderby;
            }
            else {
                queryOptions += Utils.toString(this._orderby);
            }
        }
        // add search
        if (!Utils.isNullOrUndefined(this._search) && !Utils.isEmpty(this._search)) {
            if (queryOptions.length) {
                queryOptions += this._separator;
            }
            queryOptions += '$search=' + encodeURIComponent(this._search.toString());
        }
        // add skip
        if (!Utils.isNullOrUndefined(this._skip) && !Utils.isEmpty(this._skip)) {
            if (queryOptions.length) {
                queryOptions += this._separator;
            }
            queryOptions += '$skip=' + this._skip;
        }
        // add top
        if (!Utils.isNullOrUndefined(this._top) && !Utils.isEmpty(this._top)) {
            if (queryOptions.length) {
                queryOptions += this._separator;
            }
            queryOptions += '$top=' + this._top;
        }
        // add count
        if (!Utils.isNullOrUndefined(this._count) && !Utils.isEmpty(this._count)) {
            if (queryOptions.length) {
                queryOptions += this._separator;
            }
            queryOptions += '$count=' + this._count;
        }
        // add custom query options
        if (Utils.isNotNullNorUndefined(this._customOptions) && this._customOptions.size > 0) {
            this._customOptions.forEach(function (value, key, map) {
                if (Utils.isNotNullNorUndefined(key) && !Utils.isEmpty(key)
                    && Utils.isNotNullNorUndefined(value) && !Utils.isEmpty(value)) {
                    if (queryOptions.length) {
                        queryOptions += _this._separator;
                    }
                    queryOptions += key + '=' + encodeURIComponent(value);
                }
            });
        }
        // add format
        if (!Utils.isNullOrUndefined(this._format) && !Utils.isEmpty(this._format)) {
            if (queryOptions.length) {
                queryOptions += this._separator;
            }
            queryOptions += '$format=' + this._format;
        }
        return queryOptions;
    };
    /**
     * @return {?}
     */
    QueryOptions.prototype.isEmpty = /**
     * @return {?}
     */
    function () {
        for (var key in this) {
            if (key === '_purpose' || key === '_separator') {
                continue;
            }
            if (this.hasOwnProperty(key) && !Utils.isEmpty(this[key])) {
                return false;
            }
        }
        return true;
    };
    return QueryOptions;
}());
export { QueryOptions };
if (false) {
    /** @type {?} */
    QueryOptions.prototype._separator;
    /** @type {?} */
    QueryOptions.prototype._select;
    /** @type {?} */
    QueryOptions.prototype._filter;
    /** @type {?} */
    QueryOptions.prototype._expand;
    /** @type {?} */
    QueryOptions.prototype._orderby;
    /** @type {?} */
    QueryOptions.prototype._search;
    /** @type {?} */
    QueryOptions.prototype._skip;
    /** @type {?} */
    QueryOptions.prototype._top;
    /** @type {?} */
    QueryOptions.prototype._count;
    /** @type {?} */
    QueryOptions.prototype._customOptions;
    /** @type {?} */
    QueryOptions.prototype._format;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlcnktb3B0aW9ucy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL29kYXRhLXY0LW5nLyIsInNvdXJjZXMiOlsibGliL3F1ZXJ5LW9wdGlvbnMvcXVlcnktb3B0aW9ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRXRELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDbEMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFHcEMsSUFBQTtJQWFFLHNCQUFZLFNBQWlCO1FBQzNCLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxTQUFTLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFDekQsS0FBSyxDQUFDLGVBQWUsQ0FBQyxTQUFTLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFDOUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxTQUFTLENBQUM7UUFDNUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDcEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDcEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDcEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDckIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDcEIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbEIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7UUFDbkIsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7UUFDM0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7S0FDckI7Ozs7O0lBRUQsNkJBQU07Ozs7SUFBTixVQUFPLE1BQXlCO1FBQzlCLEVBQUUsQ0FBQyxD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SSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMxRCxNQUFNLENBQUMsS0FBSyxDQUFDO2FBQ2Q7U0FDRjtRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7S0FDYjt1QkE5Tkg7SUErTkMsQ0FBQTtBQXhORCx3QkF3TkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGaWx0ZXJTdHJpbmcgfSBmcm9tICcuL2ZpbHRlci9maWx0ZXItc3RyaW5nJztcbmltcG9ydCB7IEZpbHRlciB9IGZyb20gJy4vZmlsdGVyL2ZpbHRlcic7XG5pbXBvcnQgeyBFeHBhbmQgfSBmcm9tICcuL2V4cGFuZCc7XG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4uL3V0aWxzL3V0aWxzJztcbmltcG9ydCB7IE9yZGVyYnkgfSBmcm9tICcuL29yZGVyYnknO1xuaW1wb3J0IHsgU2VhcmNoIH0gZnJvbSAnLi9zZWFyY2gvc2VhcmNoJztcblxuZXhwb3J0IGNsYXNzIFF1ZXJ5T3B0aW9ucyB7XG4gIHByaXZhdGUgX3NlcGFyYXRvcjogc3RyaW5nO1xuICBwcml2YXRlIF9zZWxlY3Q6IHN0cmluZ1tdO1xuICBwcml2YXRlIF9maWx0ZXI6IEZpbHRlcjtcbiAgcHJpdmF0ZSBfZXhwYW5kOiBFeHBhbmRbXTtcbiAgcHJpdmF0ZSBfb3JkZXJieTogT3JkZXJieVtdO1xuICBwcml2YXRlIF9zZWFyY2g6IHN0cmluZyB8IFNlYXJjaDtcbiAgcHJpdmF0ZSBfc2tpcDogbnVtYmVyO1xuICBwcml2YXRlIF90b3A6IG51bWJlcjtcbiAgcHJpdmF0ZSBfY291bnQ6IGJvb2xlYW47XG4gIHByaXZhdGUgX2N1c3RvbU9wdGlvbnM6IE1hcDxzdHJpbmcsIHN0cmluZz47XG4gIHByaXZhdGUgX2Zvcm1hdDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKHNlcGFyYXRvcjogc3RyaW5nKSB7XG4gICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQoc2VwYXJhdG9yLCAnc2VwYXJhdG9yJyk7XG4gICAgVXRpbHMucmVxdWlyZU5vdEVtcHR5KHNlcGFyYXRvciwgJ3NlcGFyYXRvcicpO1xuICAgIHRoaXMuX3NlcGFyYXRvciA9IHNlcGFyYXRvcjtcbiAgICB0aGlzLl9zZWxlY3QgPSBudWxsO1xuICAgIHRoaXMuX2ZpbHRlciA9IG51bGw7XG4gICAgdGhpcy5fZXhwYW5kID0gbnVsbDtcbiAgICB0aGlzLl9vcmRlcmJ5ID0gbnVsbDtcbiAgICB0aGlzLl9zZWFyY2ggPSBudWxsO1xuICAgIHRoaXMuX3NraXAgPSBudWxsO1xuICAgIHRoaXMuX3RvcCA9IG51bGw7XG4gICAgdGhpcy5fY291bnQgPSBudWxsO1xuICAgIHRoaXMuX2N1c3RvbU9wdGlvbnMgPSBudWxsO1xuICAgIHRoaXMuX2Zvcm1hdCA9IG51bGw7XG4gIH1cblxuICBzZWxlY3Qoc2VsZWN0OiBzdHJpbmcgfCBzdHJpbmdbXSk6IFF1ZXJ5T3B0aW9ucyB7XG4gICAgaWYgKFV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKHNlbGVjdCkgfHwgVXRpbHMuaXNFbXB0eShzZWxlY3QpKSB7XG4gICAgICB0aGlzLl9zZWxlY3QgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9zZWxlY3QgPSB0eXBlb2YgKHNlbGVjdCkgPT09ICdzdHJpbmcnID8gW3NlbGVjdF0gOiBzZWxlY3Q7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZmlsdGVyKGZpbHRlcjogc3RyaW5nIHwgRmlsdGVyKTogUXVlcnlPcHRpb25zIHtcbiAgICBpZiAoVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQoZmlsdGVyKSB8fCBVdGlscy5pc0VtcHR5KGZpbHRlcikpIHtcbiAgICAgIHRoaXMuX2ZpbHRlciA9IG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2ZpbHRlciA9IHR5cGVvZiAoZmlsdGVyKSA9PT0gJ3N0cmluZycgPyBuZXcgRmlsdGVyU3RyaW5nKGZpbHRlcikgOiBmaWx0ZXI7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZXhwYW5kKGV4cGFuZDogc3RyaW5nIHwgRXhwYW5kIHwgRXhwYW5kW10pOiBRdWVyeU9wdGlvbnMge1xuICAgIGlmIChVdGlscy5pc051bGxPclVuZGVmaW5lZChleHBhbmQpIHx8IFV0aWxzLmlzRW1wdHkoZXhwYW5kKSkge1xuICAgICAgdGhpcy5fZXhwYW5kID0gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fZXhwYW5kID0gdHlwZW9mIChleHBhbmQpID09PSAnc3RyaW5nJyA/IFtuZXcgRXhwYW5kKGV4cGFuZCldIDogZXhwYW5kIGluc3RhbmNlb2YgRXhwYW5kID8gW2V4cGFuZF0gOiBleHBhbmQ7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgb3JkZXJieShvcmRlcmJ5OiBzdHJpbmcgfCBPcmRlcmJ5W10pOiBRdWVyeU9wdGlvbnMge1xuICAgIGlmIChVdGlscy5pc051bGxPclVuZGVmaW5lZChvcmRlcmJ5KSB8fCBVdGlscy5pc0VtcHR5KG9yZGVyYnkpKSB7XG4gICAgICB0aGlzLl9vcmRlcmJ5ID0gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fb3JkZXJieSA9IHR5cGVvZiAob3JkZXJieSkgPT09ICdzdHJpbmcnID8gW25ldyBPcmRlcmJ5KG9yZGVyYnkpXSA6IG9yZGVyYnk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgc2VhcmNoKHNlYXJjaDogc3RyaW5nIHwgU2VhcmNoKTogUXVlcnlPcHRpb25zIHtcbiAgICB0aGlzLl9zZWFyY2ggPSBzZWFyY2g7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBza2lwKHNraXA6IG51bWJlcik6IFF1ZXJ5T3B0aW9ucyB7XG4gICAgVXRpbHMucmVxdWlyZU5vdE5lZ2F0aXZlKHNraXAsICdza2lwJyk7XG4gICAgdGhpcy5fc2tpcCA9IHNraXA7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICB0b3AodG9wOiBudW1iZXIpOiBRdWVyeU9wdGlvbnMge1xuICAgIFV0aWxzLnJlcXVpcmVOb3ROZWdhdGl2ZSh0b3AsICd0b3AnKTtcbiAgICB0aGlzLl90b3AgPSB0b3A7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBjb3VudChjb3VudDogYm9vbGVhbik6IFF1ZXJ5T3B0aW9ucyB7XG4gICAgdGhpcy5fY291bnQgPSBjb3VudDtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGZvcm1hdChmb3JtYXQ6IHN0cmluZyk6IFF1ZXJ5T3B0aW9ucyB7XG4gICAgdGhpcy5fZm9ybWF0ID0gZm9ybWF0O1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgY3VzdG9tT3B0aW9uKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKSB7XG4gICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQoa2V5LCAna2V5Jyk7XG4gICAgaWYgKFV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKHRoaXMuX2N1c3RvbU9wdGlvbnMpKSB7XG4gICAgICB0aGlzLl9jdXN0b21PcHRpb25zID0gbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKTtcbiAgICB9XG4gICAgdGhpcy5fY3VzdG9tT3B0aW9ucy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgIC8vIHF1ZXJ5IG9wdGlvbnNcbiAgICBsZXQgcXVlcnlPcHRpb25zID0gJyc7XG5cbiAgICAvLyBhZGQgc2VsZWN0XG4gICAgaWYgKCFVdGlscy5pc051bGxPclVuZGVmaW5lZCh0aGlzLl9zZWxlY3QpICYmICFVdGlscy5pc0VtcHR5KHRoaXMuX3NlbGVjdCkpIHtcbiAgICAgIHF1ZXJ5T3B0aW9ucyArPSAnJHNlbGVjdD0nO1xuICAgICAgaWYgKHR5cGVvZiAodGhpcy5fc2VsZWN0KSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcXVlcnlPcHRpb25zICs9IHRoaXMuX3NlbGVjdDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHF1ZXJ5T3B0aW9ucyArPSBVdGlscy50b1N0cmluZyh0aGlzLl9zZWxlY3QpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGFkZCBmaWx0ZXJcbiAgICBpZiAoIVV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKHRoaXMuX2ZpbHRlcikgJiYgIVV0aWxzLmlzRW1wdHkodGhpcy5fZmlsdGVyKSkge1xuICAgICAgaWYgKHF1ZXJ5T3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgcXVlcnlPcHRpb25zICs9IHRoaXMuX3NlcGFyYXRvcjtcbiAgICAgIH1cbiAgICAgIHF1ZXJ5T3B0aW9ucyArPSAnJGZpbHRlcj0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuX2ZpbHRlci50b1N0cmluZygpKTtcbiAgICB9XG5cbiAgICAvLyBhZGQgZXhwYW5kXG4gICAgaWYgKCFVdGlscy5pc051bGxPclVuZGVmaW5lZCh0aGlzLl9leHBhbmQpICYmICFVdGlscy5pc0VtcHR5KHRoaXMuX2V4cGFuZCkpIHtcbiAgICAgIGlmIChxdWVyeU9wdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgIHF1ZXJ5T3B0aW9ucyArPSB0aGlzLl9zZXBhcmF0b3I7XG4gICAgICB9XG4gICAgICBxdWVyeU9wdGlvbnMgKz0gJyRleHBhbmQ9JztcbiAgICAgIGlmICh0eXBlb2YgKHRoaXMuX2V4cGFuZCkgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHF1ZXJ5T3B0aW9ucyArPSB0aGlzLl9leHBhbmQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBxdWVyeU9wdGlvbnMgKz0gVXRpbHMudG9TdHJpbmcodGhpcy5fZXhwYW5kKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBhZGQgb3JkZXJieVxuICAgIGlmICghVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQodGhpcy5fb3JkZXJieSkgJiYgIVV0aWxzLmlzRW1wdHkodGhpcy5fb3JkZXJieSkpIHtcbiAgICAgIGlmIChxdWVyeU9wdGlvbnMubGVuZ3RoKSB7XG4gICAgICAgIHF1ZXJ5T3B0aW9ucyArPSB0aGlzLl9zZXBhcmF0b3I7XG4gICAgICB9XG4gICAgICBxdWVyeU9wdGlvbnMgKz0gJyRvcmRlcmJ5PSc7XG4gICAgICBpZiAodHlwZW9mICh0aGlzLl9vcmRlcmJ5KSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcXVlcnlPcHRpb25zICs9IHRoaXMuX29yZGVyYnk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBxdWVyeU9wdGlvbnMgKz0gVXRpbHMudG9TdHJpbmcodGhpcy5fb3JkZXJieSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gYWRkIHNlYXJjaFxuICAgIGlmICghVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQodGhpcy5fc2VhcmNoKSAmJiAhVXRpbHMuaXNFbXB0eSh0aGlzLl9zZWFyY2gpKSB7XG4gICAgICBpZiAocXVlcnlPcHRpb25zLmxlbmd0aCkge1xuICAgICAgICBxdWVyeU9wdGlvbnMgKz0gdGhpcy5fc2VwYXJhdG9yO1xuICAgICAgfVxuICAgICAgcXVlcnlPcHRpb25zICs9ICckc2VhcmNoPScgKyBlbmNvZGVVUklDb21wb25lbnQodGhpcy5fc2VhcmNoLnRvU3RyaW5nKCkpO1xuICAgIH1cblxuICAgIC8vIGFkZCBza2lwXG4gICAgaWYgKCFVdGlscy5pc051bGxPclVuZGVmaW5lZCh0aGlzLl9za2lwKSAmJiAhVXRpbHMuaXNFbXB0eSh0aGlzLl9za2lwKSkge1xuICAgICAgaWYgKHF1ZXJ5T3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgcXVlcnlPcHRpb25zICs9IHRoaXMuX3NlcGFyYXRvcjtcbiAgICAgIH1cbiAgICAgIHF1ZXJ5T3B0aW9ucyArPSAnJHNraXA9JyArIHRoaXMuX3NraXA7XG4gICAgfVxuXG4gICAgLy8gYWRkIHRvcFxuICAgIGlmICghVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQodGhpcy5fdG9wKSAmJiAhVXRpbHMuaXNFbXB0eSh0aGlzLl90b3ApKSB7XG4gICAgICBpZiAocXVlcnlPcHRpb25zLmxlbmd0aCkge1xuICAgICAgICBxdWVyeU9wdGlvbnMgKz0gdGhpcy5fc2VwYXJhdG9yO1xuICAgICAgfVxuICAgICAgcXVlcnlPcHRpb25zICs9ICckdG9wPScgKyB0aGlzLl90b3A7XG4gICAgfVxuXG4gICAgLy8gYWRkIGNvdW50XG4gICAgaWYgKCFVdGlscy5pc051bGxPclVuZGVmaW5lZCh0aGlzLl9jb3VudCkgJiYgIVV0aWxzLmlzRW1wdHkodGhpcy5fY291bnQpKSB7XG4gICAgICBpZiAocXVlcnlPcHRpb25zLmxlbmd0aCkge1xuICAgICAgICBxdWVyeU9wdGlvbnMgKz0gdGhpcy5fc2VwYXJhdG9yO1xuICAgICAgfVxuICAgICAgcXVlcnlPcHRpb25zICs9ICckY291bnQ9JyArIHRoaXMuX2NvdW50O1xuICAgIH1cblxuICAgIC8vIGFkZCBjdXN0b20gcXVlcnkgb3B0aW9uc1xuICAgIGlmIChVdGlscy5pc05vdE51bGxOb3JVbmRlZmluZWQodGhpcy5fY3VzdG9tT3B0aW9ucykgJiYgdGhpcy5fY3VzdG9tT3B0aW9ucy5zaXplID4gMCkge1xuICAgICAgdGhpcy5fY3VzdG9tT3B0aW9ucy5mb3JFYWNoKCh2YWx1ZTogc3RyaW5nLCBrZXk6IHN0cmluZywgbWFwOiBNYXA8c3RyaW5nLCBzdHJpbmc+KSA9PiB7XG4gICAgICAgIGlmIChVdGlscy5pc05vdE51bGxOb3JVbmRlZmluZWQoa2V5KSAmJiAhVXRpbHMuaXNFbXB0eShrZXkpXG4gICAgICAgICAgJiYgVXRpbHMuaXNOb3ROdWxsTm9yVW5kZWZpbmVkKHZhbHVlKSAmJiAhVXRpbHMuaXNFbXB0eSh2YWx1ZSkpIHtcbiAgICAgICAgICBpZiAocXVlcnlPcHRpb25zLmxlbmd0aCkge1xuICAgICAgICAgICAgcXVlcnlPcHRpb25zICs9IHRoaXMuX3NlcGFyYXRvcjtcbiAgICAgICAgICB9XG4gICAgICAgICAgcXVlcnlPcHRpb25zICs9IGtleSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIGFkZCBmb3JtYXRcbiAgICBpZiAoIVV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKHRoaXMuX2Zvcm1hdCkgJiYgIVV0aWxzLmlzRW1wdHkodGhpcy5fZm9ybWF0KSkge1xuICAgICAgaWYgKHF1ZXJ5T3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgcXVlcnlPcHRpb25zICs9IHRoaXMuX3NlcGFyYXRvcjtcbiAgICAgIH1cbiAgICAgIHF1ZXJ5T3B0aW9ucyArPSAnJGZvcm1hdD0nICsgdGhpcy5fZm9ybWF0O1xuICAgIH1cblxuICAgIHJldHVybiBxdWVyeU9wdGlvbnM7XG4gIH1cblxuICBpc0VtcHR5KCk6IGJvb2xlYW4ge1xuICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMpIHtcbiAgICAgIGlmIChrZXkgPT09ICdfcHVycG9zZScgfHwga2V5ID09PSAnX3NlcGFyYXRvcicpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShrZXkpICYmICFVdGlscy5pc0VtcHR5KHRoaXNba2V5XSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuIl19