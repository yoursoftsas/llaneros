/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { HttpHeaders } from '@angular/common/http';
import { UUID } from 'angular2-uuid';
import { Utils } from '../utils/utils';
import { ODataQueryAbstract } from './odata-query-abstract';
/** @enum {number} */
var Method = {
    GET: 0, POST: 1, PUT: 2, PATCH: 3, DELETE: 4,
};
export { Method };
Method[Method.GET] = 'GET';
Method[Method.POST] = 'POST';
Method[Method.PUT] = 'PUT';
Method[Method.PATCH] = 'PATCH';
Method[Method.DELETE] = 'DELETE';
var BatchRequest = /** @class */ (function () {
    function BatchRequest(method, odataQuery, body, httpOptions) {
        this.method = method;
        this.odataQuery = odataQuery;
        this.body = body;
        this.httpOptions = httpOptions;
    }
    return BatchRequest;
}());
export { BatchRequest };
if (false) {
    /** @type {?} */
    BatchRequest.prototype.method;
    /** @type {?} */
    BatchRequest.prototype.odataQuery;
    /** @type {?} */
    BatchRequest.prototype.body;
    /** @type {?} */
    BatchRequest.prototype.httpOptions;
}
var ODataQueryBatch = /** @class */ (function (_super) {
    tslib_1.__extends(ODataQueryBatch, _super);
    function ODataQueryBatch(odataService, serviceRoot) {
        var _this = _super.call(this, odataService, serviceRoot) || this;
        Utils.requireNotNullNorUndefined(odataService, 'odataService');
        Utils.requireNotNullNorUndefined(serviceRoot, 'serviceRoot');
        Utils.requireNotEmpty(serviceRoot, 'serviceRoot');
        _this.queryString = Utils.appendSegment(serviceRoot, ODataQueryBatch.$BATCH);
        _this.requests = [];
        _this.batchBoundary = ODataQueryBatch.BATCH_PREFIX + _this.getUUID();
        _this.changesetBoundary = null;
        _this.changesetID = 1;
        return _this;
    }
    /**
     * @param {?} odataQuery
     * @param {?=} httpOptions
     * @return {?}
     */
    ODataQueryBatch.prototype.get = /**
     * @param {?} odataQuery
     * @param {?=} httpOptions
     * @return {?}
     */
    function (odataQuery, httpOptions) {
        Utils.requireNotNullNorUndefined(odataQuery, 'odataQuery');
        this.requests.push(new BatchRequest(Method.GET, odataQuery, undefined, httpOptions));
        return this;
    };
    /**
     * @param {?} odataQuery
     * @param {?} body
     * @param {?=} httpOptions
     * @return {?}
     */
    ODataQueryBatch.prototype.post = /**
     * @param {?} odataQuery
     * @param {?} body
     * @param {?=} httpOptions
     * @return {?}
     */
    function (odataQuery, body, httpOptions) {
        Utils.requireNotNullNorUndefined(odataQuery, 'odataQuery');
        this.requests.push(new BatchRequest(Method.POST, odataQuery, body, httpOptions));
        return this;
    };
    /**
     * @param {?} odataQuery
     * @param {?} body
     * @param {?=} httpOptions
     * @return {?}
     */
    ODataQueryBatch.prototype.put = /**
     * @param {?} odataQuery
     * @param {?} body
     * @param {?=} httpOptions
     * @return {?}
     */
    function (odataQuery, body, httpOptions) {
        Utils.requireNotNullNorUndefined(odataQuery, 'odataQuery');
        this.requests.push(new BatchRequest(Method.PUT, odataQuery, body, httpOptions));
        return this;
    };
    /**
     * @param {?} odataQuery
     * @param {?} body
     * @param {?=} httpOptions
     * @return {?}
     */
    ODataQueryBatch.prototype.patch = /**
     * @param {?} odataQuery
     * @param {?} body
     * @param {?=} httpOptions
     * @return {?}
     */
    function (odataQuery, body, httpOptions) {
        Utils.requireNotNullNorUndefined(odataQuery, 'odataQuery');
        this.requests.push(new BatchRequest(Method.PATCH, odataQuery, body, httpOptions));
        return this;
    };
    /**
     * @param {?} odataQuery
     * @param {?=} httpOptions
     * @return {?}
     */
    ODataQueryBatch.prototype.delete = /**
     * @param {?} odataQuery
     * @param {?=} httpOptions
     * @return {?}
     */
    function (odataQuery, httpOptions) {
        Utils.requireNotNullNorUndefined(odataQuery, 'odataQuery');
        this.requests.push(new BatchRequest(Method.DELETE, odataQuery, undefined, httpOptions));
        return this;
    };
    /**
     * @param {?=} httpOptions
     * @return {?}
     */
    ODataQueryBatch.prototype.execute = /**
     * @param {?=} httpOptions
     * @return {?}
     */
    function (httpOptions) {
        // set headers
        if (Utils.isNullOrUndefined(httpOptions)) {
            httpOptions = {};
        }
        if (Utils.isNullOrUndefined(httpOptions.headers)) {
            httpOptions.headers = new HttpHeaders();
        }
        httpOptions.headers = httpOptions.headers.set(ODataQueryBatch.ODATA_VERSION, ODataQueryBatch.VERSION_4_0);
        httpOptions.headers = httpOptions.headers.set(ODataQueryBatch.CONTENT_TYPE, ODataQueryBatch.MULTIPART_MIXED_BOUNDARY + this.batchBoundary);
        httpOptions.headers = httpOptions.headers.set(ODataQueryBatch.ACCEPT, ODataQueryBatch.MULTIPART_MIXED);
        // send request
        return this.odataService.post(this, this.getBody(), httpOptions);
    };
    /**
     * @return {?}
     */
    ODataQueryBatch.prototype.toString = /**
     * @return {?}
     */
    function () {
        return this.queryString;
    };
    /**
     * @return {?}
     */
    ODataQueryBatch.prototype.getBody = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var res = '';
        try {
            for (var _a = tslib_1.__values(this.requests), _b = _a.next(); !_b.done; _b = _a.next()) {
                var request = _b.value;
                /** @type {?} */
                var method = request.method;
                /** @type {?} */
                var odataQuery = request.odataQuery;
                /** @type {?} */
                var httpOptions = request.httpOptions;
                /** @type {?} */
                var body = request.body;
                // if method is GET and there is a changeset boundary open then close it
                if (method === Method.GET && Utils.isNotNullNorUndefined(this.changesetBoundary)) {
                    res += ODataQueryBatch.BOUNDARY_PREFIX_SUFFIX + this.changesetBoundary + ODataQueryBatch.BOUNDARY_PREFIX_SUFFIX + ODataQueryBatch.NEWLINE;
                    this.changesetBoundary = null;
                }
                // if there is no changeset boundary open then open a batch boundary
                if (Utils.isNullOrUndefined(this.changesetBoundary)) {
                    res += ODataQueryBatch.BOUNDARY_PREFIX_SUFFIX + this.batchBoundary + ODataQueryBatch.NEWLINE;
                }
                // if method is not GET and there is no changeset boundary open then open a changeset boundary
                if (method !== Method.GET) {
                    if (Utils.isNullOrUndefined(this.changesetBoundary)) {
                        this.changesetBoundary = ODataQueryBatch.CHANGESET_PREFIX + this.getUUID();
                        res += ODataQueryBatch.CONTENT_TYPE + ': ' + ODataQueryBatch.MULTIPART_MIXED_BOUNDARY + this.changesetBoundary + ODataQueryBatch.NEWLINE;
                        res += ODataQueryBatch.NEWLINE;
                    }
                    res += ODataQueryBatch.BOUNDARY_PREFIX_SUFFIX + this.changesetBoundary + ODataQueryBatch.NEWLINE;
                }
                res += ODataQueryBatch.CONTENT_TYPE + ': ' + ODataQueryBatch.APPLICATION_HTTP + ODataQueryBatch.NEWLINE;
                res += ODataQueryBatch.CONTENT_TRANSFER_ENCODING + ': ' + ODataQueryBatch.BINARY + ODataQueryBatch.NEWLINE;
                if (method !== Method.GET) {
                    res += ODataQueryBatch.CONTENT_ID + ': ' + this.changesetID++ + ODataQueryBatch.NEWLINE;
                }
                res += ODataQueryBatch.NEWLINE;
                res += Method[method] + ' ' + odataQuery + ' ' + ODataQueryBatch.HTTP11 + ODataQueryBatch.NEWLINE;
                res += this.getHeaders(method, httpOptions);
                res += ODataQueryBatch.NEWLINE;
                if (method === Method.GET || method === Method.DELETE) {
                    res += ODataQueryBatch.NEWLINE;
                }
                else {
                    res += JSON.stringify(body) + ODataQueryBatch.NEWLINE;
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_b && !_b.done && (_c = _a.return)) _c.call(_a);
            }
            finally { if (e_1) throw e_1.error; }
        }
        if (res.length) {
            if (Utils.isNotNullNorUndefined(this.changesetBoundary)) {
                res += ODataQueryBatch.BOUNDARY_PREFIX_SUFFIX + this.changesetBoundary + ODataQueryBatch.BOUNDARY_PREFIX_SUFFIX + ODataQueryBatch.NEWLINE;
                this.changesetBoundary = null;
            }
            res += ODataQueryBatch.BOUNDARY_PREFIX_SUFFIX + this.batchBoundary + ODataQueryBatch.BOUNDARY_PREFIX_SUFFIX;
        }
        return res;
        var e_1, _c;
    };
    /**
     * @param {?} method
     * @param {?} httpOptions
     * @return {?}
     */
    ODataQueryBatch.prototype.getHeaders = /**
     * @param {?} method
     * @param {?} httpOptions
     * @return {?}
     */
    function (method, httpOptions) {
        /** @type {?} */
        var res = '';
        if (method === Method.POST || method === Method.PATCH || method === Method.PUT) {
            res += ODataQueryBatch.CONTENT_TYPE + ': ' + ODataQueryBatch.APPLICATION_JSON + ODataQueryBatch.NEWLINE;
        }
        if (Utils.isNullOrUndefined(httpOptions) || Utils.isNullOrUndefined(httpOptions.headers)) {
            return res;
        }
        try {
            for (var _a = tslib_1.__values(httpOptions.headers.keys()), _b = _a.next(); !_b.done; _b = _a.next()) {
                var key = _b.value;
                res += key + ': ' + httpOptions.headers.getAll(key) + ODataQueryBatch.NEWLINE;
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_b && !_b.done && (_c = _a.return)) _c.call(_a);
            }
            finally { if (e_2) throw e_2.error; }
        }
        return res;
        var e_2, _c;
    };
    /**
     * @return {?}
     */
    ODataQueryBatch.prototype.getUUID = /**
     * @return {?}
     */
    function () {
        return UUID.UUID();
    };
    ODataQueryBatch.BOUNDARY_PREFIX_SUFFIX = '--';
    ODataQueryBatch.BATCH_PREFIX = 'batch_';
    ODataQueryBatch.CHANGESET_PREFIX = 'changeset_';
    ODataQueryBatch.NEWLINE = '\r\n';
    ODataQueryBatch.$BATCH = '$batch';
    ODataQueryBatch.HTTP11 = 'HTTP/1.1';
    ODataQueryBatch.ODATA_VERSION = 'OData-Version';
    ODataQueryBatch.CONTENT_TYPE = 'Content-Type';
    ODataQueryBatch.ACCEPT = 'Accept';
    ODataQueryBatch.CONTENT_TRANSFER_ENCODING = 'Content-Transfer-Encoding';
    ODataQueryBatch.CONTENT_ID = 'Content-ID';
    ODataQueryBatch.VERSION_4_0 = '4.0';
    ODataQueryBatch.MULTIPART_MIXED = 'multipart/mixed';
    ODataQueryBatch.MULTIPART_MIXED_BOUNDARY = 'multipart/mixed;boundary=';
    ODataQueryBatch.APPLICATION_HTTP = 'application/http';
    ODataQueryBatch.BINARY = 'binary';
    ODataQueryBatch.APPLICATION_JSON = 'application/json';
    return ODataQueryBatch;
}(ODataQueryAbstract));
export { ODataQueryBatch };
if (false) {
    /** @type {?} */
    ODataQueryBatch.BOUNDARY_PREFIX_SUFFIX;
    /** @type {?} */
    ODataQueryBatch.BATCH_PREFIX;
    /** @type {?} */
    ODataQueryBatch.CHANGESET_PREFIX;
    /** @type {?} */
    ODataQueryBatch.NEWLINE;
    /** @type {?} */
    ODataQueryBatch.$BATCH;
    /** @type {?} */
    ODataQueryBatch.HTTP11;
    /** @type {?} */
    ODataQueryBatch.ODATA_VERSION;
    /** @type {?} */
    ODataQueryBatch.CONTENT_TYPE;
    /** @type {?} */
    ODataQueryBatch.ACCEPT;
    /** @type {?} */
    ODataQueryBatch.CONTENT_TRANSFER_ENCODING;
    /** @type {?} */
    ODataQueryBatch.CONTENT_ID;
    /** @type {?} */
    ODataQueryBatch.VERSION_4_0;
    /** @type {?} */
    ODataQueryBatch.MULTIPART_MIXED;
    /** @type {?} */
    ODataQueryBatch.MULTIPART_MIXED_BOUNDARY;
    /** @type {?} */
    ODataQueryBatch.APPLICATION_HTTP;
    /** @type {?} */
    ODataQueryBatch.BINARY;
    /** @type {?} */
    ODataQueryBatch.APPLICATION_JSON;
    /** @type {?} */
    ODataQueryBatch.prototype.requests;
    /** @type {?} */
    ODataQueryBatch.prototype.batchBoundary;
    /** @type {?} */
    ODataQueryBatch.prototype.changesetBoundary;
    /** @type {?} */
    ODataQueryBatch.prototype.changesetID;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2RhdGEtcXVlcnktYmF0Y2guanMiLCJzb3VyY2VSb290Ijoibmc6Ly9vZGF0YS12NC1uZy8iLCJzb3VyY2VzIjpbImxpYi9vZGF0YS1xdWVyeS9vZGF0YS1xdWVyeS1iYXRjaC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNuRCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBS3JDLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV2QyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQzs7O0lBSTFELE1BQUcsRUFBRSxPQUFJLEVBQUUsTUFBRyxFQUFFLFFBQUssRUFBRSxTQUFNOzs7Y0FBN0IsR0FBRztjQUFFLElBQUk7Y0FBRSxHQUFHO2NBQUUsS0FBSztjQUFFLE1BQU07QUFHL0IsSUFBQTtJQUNFLHNCQUNTLFFBQ0EsWUFDQSxNQUNBO1FBSEEsV0FBTSxHQUFOLE1BQU07UUFDTixlQUFVLEdBQVYsVUFBVTtRQUNWLFNBQUksR0FBSixJQUFJO1FBQ0osZ0JBQVcsR0FBWCxXQUFXO0tBQW9CO3VCQXBCMUM7SUFxQkMsQ0FBQTtBQU5ELHdCQU1DOzs7Ozs7Ozs7Ozs7SUFFb0MsMkNBQWtCO0lBK0JyRCx5QkFBWSxZQUEwQixFQUFFLFdBQW1CO1FBQTNELFlBQ0Usa0JBQU0sWUFBWSxFQUFFLFdBQVcsQ0FBQyxTQVNqQztRQVJDLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxZQUFZLEVBQUUsY0FBYyxDQUFDLENBQUM7UUFDL0QsS0FBSyxDQUFDLDBCQUEwQixDQUFDLFdBQVcsRUFBRSxhQUFhLENBQUMsQ0FBQztRQUM3RCxLQUFLLENBQUMsZUFBZSxDQUFDLFdBQVcsRUFBRSxhQUFhLENBQUMsQ0FBQztRQUNsRCxLQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQyxhQUFhLENBQUMsV0FBVyxFQUFFLGVBQWUs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QUNkLFFBQVE7dUNBQ0osWUFBWTs4QkFDckIsTUFBTTs2QkFHUCxRQUFROzZCQUdSLFVBQVU7b0NBQ0gsZUFBZTttQ0FDaEIsY0FBYzs2QkFDcEIsUUFBUTtnREFDVywyQkFBMkI7aUNBQzFDLFlBQVk7a0NBR1gsS0FBSztzQ0FDRCxpQkFBaUI7K0NBQ1IsMkJBQTJCO3VDQUNuQyxrQkFBa0I7NkJBQzVCLFFBQVE7dUNBQ0Usa0JBQWtCOzBCQTlDL0Q7RUF1QnFDLGtCQUFrQjtTQUExQyxlQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cEhlYWRlcnMgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBVVUlEIH0gZnJvbSAnYW5ndWxhcjItdXVpZCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBPRGF0YVJlc3BvbnNlIH0gZnJvbSAnLi4vb2RhdGEtcmVzcG9uc2Uvb2RhdGEtcmVzcG9uc2UnO1xuaW1wb3J0IHsgSHR0cE9wdGlvbnNJIH0gZnJvbSAnLi4vb2RhdGEtc2VydmljZS9odHRwLW9wdGlvbnMnO1xuaW1wb3J0IHsgT0RhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vb2RhdGEtc2VydmljZS9vZGF0YS5zZXJ2aWNlJztcbmltcG9ydCB7IFV0aWxzIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xuaW1wb3J0IHsgT0RhdGFRdWVyeSB9IGZyb20gJy4vb2RhdGEtcXVlcnknO1xuaW1wb3J0IHsgT0RhdGFRdWVyeUFic3RyYWN0IH0gZnJvbSAnLi9vZGF0YS1xdWVyeS1hYnN0cmFjdCc7XG5cblxuZXhwb3J0IGVudW0gTWV0aG9kIHtcbiAgR0VULCBQT1NULCBQVVQsIFBBVENILCBERUxFVEVcbn1cblxuZXhwb3J0IGNsYXNzIEJhdGNoUmVxdWVzdCB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBtZXRob2Q6IE1ldGhvZCxcbiAgICBwdWJsaWMgb2RhdGFRdWVyeTogT0RhdGFRdWVyeSxcbiAgICBwdWJsaWMgYm9keT86IGFueSxcbiAgICBwdWJsaWMgaHR0cE9wdGlvbnM/OiBIdHRwT3B0aW9uc0kpIHsgfVxufVxuXG5leHBvcnQgY2xhc3MgT0RhdGFRdWVyeUJhdGNoIGV4dGVuZHMgT0RhdGFRdWVyeUFic3RyYWN0IHtcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgQk9VTkRBUllfUFJFRklYX1NVRkZJWCA9ICctLSc7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IEJBVENIX1BSRUZJWCA9ICdiYXRjaF8nO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBDSEFOR0VTRVRfUFJFRklYID0gJ2NoYW5nZXNldF8nO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBORVdMSU5FID0gJ1xcclxcbic7XG5cbiAgLy8gQ09OU1RBTlQgU0VHTUVOVFNcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgJEJBVENIID0gJyRiYXRjaCc7XG5cbiAgLy8gSEVBREVSU1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBIVFRQMTEgPSAnSFRUUC8xLjEnO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBPREFUQV9WRVJTSU9OID0gJ09EYXRhLVZlcnNpb24nO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBDT05URU5UX1RZUEUgPSAnQ29udGVudC1UeXBlJztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgQUNDRVBUID0gJ0FjY2VwdCc7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IENPTlRFTlRfVFJBTlNGRVJfRU5DT0RJTkcgPSAnQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZyc7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IENPTlRFTlRfSUQgPSAnQ29udGVudC1JRCc7XG5cbiAgLy8gSEVBREVSIFZBTFVFU1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBWRVJTSU9OXzRfMCA9ICc0LjAnO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBNVUxUSVBBUlRfTUlYRUQgPSAnbXVsdGlwYXJ0L21peGVkJztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgTVVMVElQQVJUX01JWEVEX0JPVU5EQVJZID0gJ211bHRpcGFydC9taXhlZDtib3VuZGFyeT0nO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBBUFBMSUNBVElPTl9IVFRQID0gJ2FwcGxpY2F0aW9uL2h0dHAnO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBCSU5BUlkgPSAnYmluYXJ5JztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgQVBQTElDQVRJT05fSlNPTiA9ICdhcHBsaWNhdGlvbi9qc29uJztcblxuICAvLyBWQVJJQUJMRVNcbiAgcHJpdmF0ZSByZXF1ZXN0czogQmF0Y2hSZXF1ZXN0W107XG4gIHByaXZhdGUgYmF0Y2hCb3VuZGFyeTogc3RyaW5nO1xuICBwcml2YXRlIGNoYW5nZXNldEJvdW5kYXJ5OiBzdHJpbmc7XG4gIHByaXZhdGUgY2hhbmdlc2V0SUQ6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihvZGF0YVNlcnZpY2U6IE9EYXRhU2VydmljZSwgc2VydmljZVJvb3Q6IHN0cmluZykge1xuICAgIHN1cGVyKG9kYXRhU2VydmljZSwgc2VydmljZVJvb3QpO1xuICAgIFV0aWxzLnJlcXVpcmVOb3ROdWxsTm9yVW5kZWZpbmVkKG9kYXRhU2VydmljZSwgJ29kYXRhU2VydmljZScpO1xuICAgIFV0aWxzLnJlcXVpcmVOb3ROdWxsTm9yVW5kZWZpbmVkKHNlcnZpY2VSb290LCAnc2VydmljZVJvb3QnKTtcbiAgICBVdGlscy5yZXF1aXJlTm90RW1wdHkoc2VydmljZVJvb3QsICdzZXJ2aWNlUm9vdCcpO1xuICAgIHRoaXMucXVlcnlTdHJpbmcgPSBVdGlscy5hcHBlbmRTZWdtZW50KHNlcnZpY2VSb290LCBPRGF0YVF1ZXJ5QmF0Y2guJEJBVENIKTtcbiAgICB0aGlzLnJlcXVlc3RzID0gW107XG4gICAgdGhpcy5iYXRjaEJvdW5kYXJ5ID0gT0RhdGFRdWVyeUJhdGNoLkJBVENIX1BSRUZJWCArIHRoaXMuZ2V0VVVJRCgpO1xuICAgIHRoaXMuY2hhbmdlc2V0Qm91bmRhcnkgPSBudWxsO1xuICAgIHRoaXMuY2hhbmdlc2V0SUQgPSAxO1xuICB9XG5cbiAgZ2V0KG9kYXRhUXVlcnk6IE9EYXRhUXVlcnksIGh0dHBPcHRpb25zPzogSHR0cE9wdGlvbnNJKTogT0RhdGFRdWVyeUJhdGNoIHtcbiAgICBVdGlscy5yZXF1aXJlTm90TnVsbE5vclVuZGVmaW5lZChvZGF0YVF1ZXJ5LCAnb2RhdGFRdWVyeScpO1xuICAgIHRoaXMucmVxdWVzdHMucHVzaChuZXcgQmF0Y2hSZXF1ZXN0KE1ldGhvZC5HRVQsIG9kYXRhUXVlcnksIHVuZGVmaW5lZCwgaHR0cE9wdGlvbnMpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHBvc3Qob2RhdGFRdWVyeTogT0RhdGFRdWVyeSwgYm9keTogYW55LCBodHRwT3B0aW9ucz86IEh0dHBPcHRpb25zSSk6IE9EYXRhUXVlcnlCYXRjaCB7XG4gICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQob2RhdGFRdWVyeSwgJ29kYXRhUXVlcnknKTtcbiAgICB0aGlzLnJlcXVlc3RzLnB1c2gobmV3IEJhdGNoUmVxdWVzdChNZXRob2QuUE9TVCwgb2RhdGFRdWVyeSwgYm9keSwgaHR0cE9wdGlvbnMpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHB1dChvZGF0YVF1ZXJ5OiBPRGF0YVF1ZXJ5LCBib2R5OiBhbnksIGh0dHBPcHRpb25zPzogSHR0cE9wdGlvbnNJKTogT0RhdGFRdWVyeUJhdGNoIHtcbiAgICBVdGlscy5yZXF1aXJlTm90TnVsbE5vclVuZGVmaW5lZChvZGF0YVF1ZXJ5LCAnb2RhdGFRdWVyeScpO1xuICAgIHRoaXMucmVxdWVzdHMucHVzaChuZXcgQmF0Y2hSZXF1ZXN0KE1ldGhvZC5QVVQsIG9kYXRhUXVlcnksIGJvZHksIGh0dHBPcHRpb25zKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBwYXRjaChvZGF0YVF1ZXJ5OiBPRGF0YVF1ZXJ5LCBib2R5OiBhbnksIGh0dHBPcHRpb25zPzogSHR0cE9wdGlvbnNJKTogT0RhdGFRdWVyeUJhdGNoIHtcbiAgICBVdGlscy5yZXF1aXJlTm90TnVsbE5vclVuZGVmaW5lZChvZGF0YVF1ZXJ5LCAnb2RhdGFRdWVyeScpO1xuICAgIHRoaXMucmVxdWVzdHMucHVzaChuZXcgQmF0Y2hSZXF1ZXN0KE1ldGhvZC5QQVRDSCwgb2RhdGFRdWVyeSwgYm9keSwgaHR0cE9wdGlvbnMpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGRlbGV0ZShvZGF0YVF1ZXJ5OiBPRGF0YVF1ZXJ5LCBodHRwT3B0aW9ucz86IEh0dHBPcHRpb25zSSk6IE9EYXRhUXVlcnlCYXRjaCB7XG4gICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQob2RhdGFRdWVyeSwgJ29kYXRhUXVlcnknKTtcbiAgICB0aGlzLnJlcXVlc3RzLnB1c2gobmV3IEJhdGNoUmVxdWVzdChNZXRob2QuREVMRVRFLCBvZGF0YVF1ZXJ5LCB1bmRlZmluZWQsIGh0dHBPcHRpb25zKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBleGVjdXRlKGh0dHBPcHRpb25zPzogSHR0cE9wdGlvbnNJKTogT2JzZXJ2YWJsZTxPRGF0YVJlc3BvbnNlPiB7XG4gICAgLy8gc2V0IGhlYWRlcnNcbiAgICBpZiAoVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQoaHR0cE9wdGlvbnMpKSB7XG4gICAgICBodHRwT3B0aW9ucyA9IHt9O1xuICAgIH1cbiAgICBpZiAoVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQoaHR0cE9wdGlvbnMuaGVhZGVycykpIHtcbiAgICAgIGh0dHBPcHRpb25zLmhlYWRlcnMgPSBuZXcgSHR0cEhlYWRlcnMoKTtcbiAgICB9XG4gICAgaHR0cE9wdGlvbnMuaGVhZGVycyA9IGh0dHBPcHRpb25zLmhlYWRlcnMuc2V0KE9EYXRhUXVlcnlCYXRjaC5PREFUQV9WRVJTSU9OLCBPRGF0YVF1ZXJ5QmF0Y2guVkVSU0lPTl80XzApO1xuICAgIGh0dHBPcHRpb25zLmhlYWRlcnMgPSBodHRwT3B0aW9ucy5oZWFkZXJzLnNldChPRGF0YVF1ZXJ5QmF0Y2guQ09OVEVOVF9UWVBFLCBPRGF0YVF1ZXJ5QmF0Y2guTVVMVElQQVJUX01JWEVEX0JPVU5EQVJZICsgdGhpcy5iYXRjaEJvdW5kYXJ5KTtcbiAgICBodHRwT3B0aW9ucy5oZWFkZXJzID0gaHR0cE9wdGlvbnMuaGVhZGVycy5zZXQoT0RhdGFRdWVyeUJhdGNoLkFDQ0VQVCwgT0RhdGFRdWVyeUJhdGNoLk1VTFRJUEFSVF9NSVhFRCk7XG5cbiAgICAvLyBzZW5kIHJlcXVlc3RcbiAgICByZXR1cm4gdGhpcy5vZGF0YVNlcnZpY2UucG9zdCh0aGlzLCB0aGlzLmdldEJvZHkoKSwgaHR0cE9wdGlvbnMpO1xuICB9XG5cbiAgdG9TdHJpbmcoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5xdWVyeVN0cmluZztcbiAgfVxuXG4gIGdldEJvZHkoKTogc3RyaW5nIHtcbiAgICBsZXQgcmVzID0gJyc7XG5cbiAgICBmb3IgKGNvbnN0IHJlcXVlc3Qgb2YgdGhpcy5yZXF1ZXN0cykge1xuICAgICAgY29uc3QgbWV0aG9kOiBNZXRob2QgPSByZXF1ZXN0Lm1ldGhvZDtcbiAgICAgIGNvbnN0IG9kYXRhUXVlcnk6IE9EYXRhUXVlcnkgPSByZXF1ZXN0Lm9kYXRhUXVlcnk7XG4gICAgICBjb25zdCBodHRwT3B0aW9uczogSHR0cE9wdGlvbnNJID0gcmVxdWVzdC5odHRwT3B0aW9ucztcbiAgICAgIGNvbnN0IGJvZHk6IGFueSA9IHJlcXVlc3QuYm9keTtcblxuICAgICAgLy8gaWYgbWV0aG9kIGlzIEdFVCBhbmQgdGhlcmUgaXMgYSBjaGFuZ2VzZXQgYm91bmRhcnkgb3BlbiB0aGVuIGNsb3NlIGl0XG4gICAgICBpZiAobWV0aG9kID09PSBNZXRob2QuR0VUICYmIFV0aWxzLmlzTm90TnVsbE5vclVuZGVmaW5lZCh0aGlzLmNoYW5nZXNldEJvdW5kYXJ5KSkge1xuICAgICAgICByZXMgKz0gT0RhdGFRdWVyeUJhdGNoLkJPVU5EQVJZX1BSRUZJWF9TVUZGSVggKyB0aGlzLmNoYW5nZXNldEJvdW5kYXJ5ICsgT0RhdGFRdWVyeUJhdGNoLkJPVU5EQVJZX1BSRUZJWF9TVUZGSVggKyBPRGF0YVF1ZXJ5QmF0Y2guTkVXTElORTtcbiAgICAgICAgdGhpcy5jaGFuZ2VzZXRCb3VuZGFyeSA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIC8vIGlmIHRoZXJlIGlzIG5vIGNoYW5nZXNldCBib3VuZGFyeSBvcGVuIHRoZW4gb3BlbiBhIGJhdGNoIGJvdW5kYXJ5XG4gICAgICBpZiAoVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQodGhpcy5jaGFuZ2VzZXRCb3VuZGFyeSkpIHtcbiAgICAgICAgcmVzICs9IE9EYXRhUXVlcnlCYXRjaC5CT1VOREFSWV9QUkVGSVhfU1VGRklYICsgdGhpcy5iYXRjaEJvdW5kYXJ5ICsgT0RhdGFRdWVyeUJhdGNoLk5FV0xJTkU7XG4gICAgICB9XG5cbiAgICAgIC8vIGlmIG1ldGhvZCBpcyBub3QgR0VUIGFuZCB0aGVyZSBpcyBubyBjaGFuZ2VzZXQgYm91bmRhcnkgb3BlbiB0aGVuIG9wZW4gYSBjaGFuZ2VzZXQgYm91bmRhcnlcbiAgICAgIGlmIChtZXRob2QgIT09IE1ldGhvZC5HRVQpIHtcbiAgICAgICAgaWYgKFV0aWxzLmlzTnVsbE9yVW5kZWZpbmVkKHRoaXMuY2hhbmdlc2V0Qm91bmRhcnkpKSB7XG4gICAgICAgICAgdGhpcy5jaGFuZ2VzZXRCb3VuZGFyeSA9IE9EYXRhUXVlcnlCYXRjaC5DSEFOR0VTRVRfUFJFRklYICsgdGhpcy5nZXRVVUlEKCk7XG4gICAgICAgICAgcmVzICs9IE9EYXRhUXVlcnlCYXRjaC5DT05URU5UX1RZUEUgKyAnOiAnICsgT0RhdGFRdWVyeUJhdGNoLk1VTFRJUEFSVF9NSVhFRF9CT1VOREFSWSArIHRoaXMuY2hhbmdlc2V0Qm91bmRhcnkgKyBPRGF0YVF1ZXJ5QmF0Y2guTkVXTElORTtcbiAgICAgICAgICByZXMgKz0gT0RhdGFRdWVyeUJhdGNoLk5FV0xJTkU7XG4gICAgICAgIH1cbiAgICAgICAgcmVzICs9IE9EYXRhUXVlcnlCYXRjaC5CT1VOREFSWV9QUkVGSVhfU1VGRklYICsgdGhpcy5jaGFuZ2VzZXRCb3VuZGFyeSArIE9EYXRhUXVlcnlCYXRjaC5ORVdMSU5FO1xuICAgICAgfVxuXG4gICAgICByZXMgKz0gT0RhdGFRdWVyeUJhdGNoLkNPTlRFTlRfVFlQRSArICc6ICcgKyBPRGF0YVF1ZXJ5QmF0Y2guQVBQTElDQVRJT05fSFRUUCArIE9EYXRhUXVlcnlCYXRjaC5ORVdMSU5FO1xuICAgICAgcmVzICs9IE9EYXRhUXVlcnlCYXRjaC5DT05URU5UX1RSQU5TRkVSX0VOQ09ESU5HICsgJzogJyArIE9EYXRhUXVlcnlCYXRjaC5CSU5BUlkgKyBPRGF0YVF1ZXJ5QmF0Y2guTkVXTElORTtcblxuICAgICAgaWYgKG1ldGhvZCAhPT0gTWV0aG9kLkdFVCkge1xuICAgICAgICByZXMgKz0gT0RhdGFRdWVyeUJhdGNoLkNPTlRFTlRfSUQgKyAnOiAnICsgdGhpcy5jaGFuZ2VzZXRJRCsrICsgT0RhdGFRdWVyeUJhdGNoLk5FV0xJTkU7XG4gICAgICB9XG5cbiAgICAgIHJlcyArPSBPRGF0YVF1ZXJ5QmF0Y2guTkVXTElORTtcbiAgICAgIHJlcyArPSBNZXRob2RbbWV0aG9kXSArICcgJyArIG9kYXRhUXVlcnkgKyAnICcgKyBPRGF0YVF1ZXJ5QmF0Y2guSFRUUDExICsgT0RhdGFRdWVyeUJhdGNoLk5FV0xJTkU7XG5cbiAgICAgIHJlcyArPSB0aGlzLmdldEhlYWRlcnMobWV0aG9kLCBodHRwT3B0aW9ucyk7XG5cbiAgICAgIHJlcyArPSBPRGF0YVF1ZXJ5QmF0Y2guTkVXTElORTtcbiAgICAgIGlmIChtZXRob2QgPT09IE1ldGhvZC5HRVQgfHwgbWV0aG9kID09PSBNZXRob2QuREVMRVRFKSB7XG4gICAgICAgIHJlcyArPSBPRGF0YVF1ZXJ5QmF0Y2guTkVXTElORTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcyArPSBKU09OLnN0cmluZ2lmeShib2R5KSArIE9EYXRhUXVlcnlCYXRjaC5ORVdMSU5FO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChyZXMubGVuZ3RoKSB7XG4gICAgICBpZiAoVXRpbHMuaXNOb3ROdWxsTm9yVW5kZWZpbmVkKHRoaXMuY2hhbmdlc2V0Qm91bmRhcnkpKSB7XG4gICAgICAgIHJlcyArPSBPRGF0YVF1ZXJ5QmF0Y2guQk9VTkRBUllfUFJFRklYX1NVRkZJWCArIHRoaXMuY2hhbmdlc2V0Qm91bmRhcnkgKyBPRGF0YVF1ZXJ5QmF0Y2guQk9VTkRBUllfUFJFRklYX1NVRkZJWCArIE9EYXRhUXVlcnlCYXRjaC5ORVdMSU5FO1xuICAgICAgICB0aGlzLmNoYW5nZXNldEJvdW5kYXJ5ID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIHJlcyArPSBPRGF0YVF1ZXJ5QmF0Y2guQk9VTkRBUllfUFJFRklYX1NVRkZJWCArIHRoaXMuYmF0Y2hCb3VuZGFyeSArIE9EYXRhUXVlcnlCYXRjaC5CT1VOREFSWV9QUkVGSVhfU1VGRklYO1xuICAgIH1cblxuICAgIHJldHVybiByZXM7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0SGVhZGVycyhtZXRob2Q6IE1ldGhvZCwgaHR0cE9wdGlvbnM6IEh0dHBPcHRpb25zSSk6IHN0cmluZyB7XG4gICAgbGV0IHJlcyA9ICcnO1xuXG4gICAgaWYgKG1ldGhvZCA9PT0gTWV0aG9kLlBPU1QgfHwgbWV0aG9kID09PSBNZXRob2QuUEFUQ0ggfHwgbWV0aG9kID09PSBNZXRob2QuUFVUKSB7XG4gICAgICByZXMgKz0gT0RhdGFRdWVyeUJhdGNoLkNPTlRFTlRfVFlQRSArICc6ICcgKyBPRGF0YVF1ZXJ5QmF0Y2guQVBQTElDQVRJT05fSlNPTiArIE9EYXRhUXVlcnlCYXRjaC5ORVdMSU5FO1xuICAgIH1cblxuICAgIGlmIChVdGlscy5pc051bGxPclVuZGVmaW5lZChodHRwT3B0aW9ucykgfHwgVXRpbHMuaXNOdWxsT3JVbmRlZmluZWQoaHR0cE9wdGlvbnMuaGVhZGVycykpIHtcbiAgICAgIHJldHVybiByZXM7XG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBrZXkgb2YgaHR0cE9wdGlvbnMuaGVhZGVycy5rZXlzKCkpIHtcbiAgICAgIHJlcyArPSBrZXkgKyAnOiAnICsgaHR0cE9wdGlvbnMuaGVhZGVycy5nZXRBbGwoa2V5KSArIE9EYXRhUXVlcnlCYXRjaC5ORVdMSU5FO1xuICAgIH1cblxuICAgIHJldHVybiByZXM7XG4gIH1cblxuICBnZXRVVUlEKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIFVVSUQuVVVJRCgpO1xuICB9XG59XG4iXX0=