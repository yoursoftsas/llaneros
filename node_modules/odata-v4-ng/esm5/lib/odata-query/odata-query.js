/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { QueryOptions } from '../query-options/query-options';
import { Utils } from '../utils/utils';
import { ODataQueryAbstract } from './odata-query-abstract';
import { ODataQueryBatch } from './odata-query-batch';
var ODataQuery = /** @class */ (function (_super) {
    tslib_1.__extends(ODataQuery, _super);
    function ODataQuery(odataService, serviceRoot) {
        var _this = _super.call(this, odataService, serviceRoot) || this;
        Utils.requireNotNullNorUndefined(odataService, 'odataService');
        Utils.requireNotNullNorUndefined(serviceRoot, 'serviceRoot');
        Utils.requireNotEmpty(serviceRoot, 'serviceRoot');
        _this.queryOptions = new QueryOptions(ODataQuery.SEPARATOR);
        _this.segments = [];
        _this.lastSegment = null;
        return _this;
    }
    // QUERY SEGMENTS
    /**
     * @return {?}
     */
    ODataQuery.prototype.metadata = /**
     * @return {?}
     */
    function () {
        Utils.requireNullOrUndefined(this.getSegment(ODataQuery.METADATA), ODataQuery.METADATA);
        if (this.segments.length) {
            throw new Error('metadata segment cannot be appended to other segments');
        }
        this.queryString = Utils.appendSegment(this.queryString, ODataQuery.$METADATA);
        this.addSegment(ODataQuery.METADATA);
        return this;
    };
    /**
     * @param {?} entitySet
     * @return {?}
     */
    ODataQuery.prototype.entitySet = /**
     * @param {?} entitySet
     * @return {?}
     */
    function (entitySet) {
        Utils.requireNullOrUndefined(this.getSegment(ODataQuery.ENTITY_SET), ODataQuery.ENTITY_SET);
        Utils.requireNotNullNorUndefined(entitySet, 'entitySet');
        Utils.requireNotEmpty(entitySet, 'entitySet');
        this.queryString = Utils.appendSegment(this.queryString, entitySet);
        this.addSegment(ODataQuery.ENTITY_SET);
        return this;
    };
    /**
     * @param {?} entityKey
     * @return {?}
     */
    ODataQuery.prototype.entityKey = /**
     * @param {?} entityKey
     * @return {?}
     */
    function (entityKey) {
        if (this.lastSegment !== ODataQuery.ENTITY_SET && this.lastSegment !== ODataQuery.NAVIGATION_PROPERTY) {
            throw new Error('entityKey can only be appended to entitySet or navigationProperty');
        }
        Utils.requireNotNullNorUndefined(entityKey, 'entityKey');
        Utils.requireNotEmpty(entityKey, 'entityKey');
        entityKey = Utils.getValueURI(entityKey, true);
        this.queryString = Utils.removeEndingSeparator(this.queryString) + '(' + entityKey + ')';
        this.addSegment(ODataQuery.ENTITY_KEY);
        return this;
    };
    /**
     * @param {?} singleton
     * @return {?}
     */
    ODataQuery.prototype.singleton = /**
     * @param {?} singleton
     * @return {?}
     */
    function (singleton) {
        if (this.segments.length) {
            throw new Error('singleton segment cannot be appended to other segments');
        }
        Utils.requireNotNullNorUndefined(singleton, 'singleton');
        Utils.requireNotEmpty(singleton, 'singleton');
        this.queryString = Utils.appendSegment(this.queryString, singleton);
        this.addSegment(ODataQuery.SINGLETON);
        return this;
    };
    /**
     * @param {?} typeName
     * @return {?}
     */
    ODataQuery.prototype.typeName = /**
     * @param {?} typeName
     * @return {?}
     */
    function (typeName) {
        if (this.lastSegment !== ODataQuery.ENTITY_SET && this.lastSegment !== ODataQuery.NAVIGATION_PROPERTY && this.lastSegment !== ODataQuery.ENTITY_KEY) {
            throw new Error('typeName can only be appended to entitySet, navigationProperty or entityKey');
        }
        Utils.requireNotNullNorUndefined(typeName, 'typeName');
        Utils.requireNotEmpty(typeName, 'typeName');
        this.queryString = Utils.appendSegment(this.queryString, typeName);
        this.addSegment(ODataQuery.TYPE_NAME);
        return this;
    };
    /**
     * @param {?} property
     * @return {?}
     */
    ODataQuery.prototype.property = /**
     * @param {?} property
     * @return {?}
     */
    function (property) {
        Utils.requireNullOrUndefined(this.getSegment(ODataQuery.PROPERTY), ODataQuery.PROPERTY);
        if (this.lastSegment !== ODataQuery.ENTITY_KEY && this.lastSegment !== ODataQuery.SINGLETON) {
            throw new Error('property can only be appended to entityKey or singleton');
        }
        Utils.requireNotNullNorUndefined(property, 'property');
        Utils.requireNotEmpty(property, 'property');
        this.queryString = Utils.appendSegment(this.queryString, property);
        this.addSegment(ODataQuery.PROPERTY);
        return this;
    };
    /**
     * @param {?} navigationProperty
     * @return {?}
     */
    ODataQuery.prototype.navigationProperty = /**
     * @param {?} navigationProperty
     * @return {?}
     */
    function (navigationProperty) {
        if (this.lastSegment !== ODataQuery.ENTITY_KEY && this.lastSegment !== ODataQuery.SINGLETON && this.lastSegment !== ODataQuery.TYPE_NAME) {
            throw new Error('navigationProperty can only be appended to entityKey, singleton or typeName');
        }
        Utils.requireNotNullNorUndefined(navigationProperty, 'navigationProperty');
        Utils.requireNotEmpty(navigationProperty, 'navigationProperty');
        this.queryString = Utils.appendSegment(this.queryString, navigationProperty);
        this.addSegment(ODataQuery.NAVIGATION_PROPERTY);
        return this;
    };
    /**
     * @return {?}
     */
    ODataQuery.prototype.ref = /**
     * @return {?}
     */
    function () {
        Utils.requireNullOrUndefined(this.getSegment(ODataQuery.REF), ODataQuery.REF);
        if (this.lastSegment !== ODataQuery.NAVIGATION_PROPERTY) {
            throw new Error('ref can only be appended to navigationProperty');
        }
        this.queryString = Utils.appendSegment(this.queryString, ODataQuery.$REF);
        this.addSegment(ODataQuery.REF);
        return this;
    };
    /**
     * @return {?}
     */
    ODataQuery.prototype.value = /**
     * @return {?}
     */
    function () {
        Utils.requireNullOrUndefined(this.getSegment(ODataQuery.VALUE), ODataQuery.VALUE);
        if (this.lastSegment !== ODataQuery.PROPERTY) {
            throw new Error('value can only be appended to property');
        }
        this.queryString = Utils.appendSegment(this.queryString, ODataQuery.$VALUE);
        this.addSegment(ODataQuery.VALUE);
        return this;
    };
    /**
     * @return {?}
     */
    ODataQuery.prototype.countSegment = /**
     * @return {?}
     */
    function () {
        Utils.requireNullOrUndefined(this.getSegment(ODataQuery.COUNT), ODataQuery.COUNT);
        if (this.lastSegment !== ODataQuery.ENTITY_SET && this.lastSegment !== ODataQuery.NAVIGATION_PROPERTY) {
            throw new Error('count can only be appended to entitySet or navigationProperty');
        }
        this.queryString = Utils.appendSegment(this.queryString, ODataQuery.$COUNT);
        this.addSegment(ODataQuery.COUNT);
        return this;
    };
    /**
     * @param {?} functionCall
     * @return {?}
     */
    ODataQuery.prototype.functionCall = /**
     * @param {?} functionCall
     * @return {?}
     */
    function (functionCall) {
        Utils.requireNotNullNorUndefined(functionCall, 'functionCall');
        Utils.requireNotEmpty(functionCall, 'functionCall');
        this.queryString = Utils.appendSegment(this.queryString, functionCall);
        this.addSegment(ODataQuery.FUNCTION_CALL);
        return this;
    };
    /**
     * @param {?} actionCall
     * @return {?}
     */
    ODataQuery.prototype.actionCall = /**
     * @param {?} actionCall
     * @return {?}
     */
    function (actionCall) {
        Utils.requireNotNullNorUndefined(actionCall, 'actionCall');
        Utils.requireNotEmpty(actionCall, 'actionCall');
        this.queryString = Utils.appendSegment(this.queryString, actionCall);
        this.addSegment(ODataQuery.ACTION_CALL);
        return this;
    };
    /**
     * @return {?}
     */
    ODataQuery.prototype.batch = /**
     * @return {?}
     */
    function () {
        return new ODataQueryBatch(this.odataService, this.serviceRoot);
    };
    // QUERY OPTIONS
    /**
     * @param {?} select
     * @return {?}
     */
    ODataQuery.prototype.select = /**
     * @param {?} select
     * @return {?}
     */
    function (select) {
        this.queryOptions.select(select);
        return this;
    };
    /**
     * @param {?} filter
     * @return {?}
     */
    ODataQuery.prototype.filter = /**
     * @param {?} filter
     * @return {?}
     */
    function (filter) {
        this.queryOptions.filter(filter);
        return this;
    };
    /**
     * @param {?} expand
     * @return {?}
     */
    ODataQuery.prototype.expand = /**
     * @param {?} expand
     * @return {?}
     */
    function (expand) {
        this.queryOptions.expand(expand);
        return this;
    };
    /**
     * @param {?} orderby
     * @return {?}
     */
    ODataQuery.prototype.orderby = /**
     * @param {?} orderby
     * @return {?}
     */
    function (orderby) {
        this.queryOptions.orderby(orderby);
        return this;
    };
    /**
     * @param {?} search
     * @return {?}
     */
    ODataQuery.prototype.search = /**
     * @param {?} search
     * @return {?}
     */
    function (search) {
        this.queryOptions.search(search);
        return this;
    };
    /**
     * @param {?} skip
     * @return {?}
     */
    ODataQuery.prototype.skip = /**
     * @param {?} skip
     * @return {?}
     */
    function (skip) {
        this.queryOptions.skip(skip);
        return this;
    };
    /**
     * @param {?} top
     * @return {?}
     */
    ODataQuery.prototype.top = /**
     * @param {?} top
     * @return {?}
     */
    function (top) {
        this.queryOptions.top(top);
        return this;
    };
    /**
     * @param {?} count
     * @return {?}
     */
    ODataQuery.prototype.countOption = /**
     * @param {?} count
     * @return {?}
     */
    function (count) {
        this.queryOptions.count(count);
        return this;
    };
    /**
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    ODataQuery.prototype.customOption = /**
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    function (key, value) {
        this.queryOptions.customOption(key, value);
        return this;
    };
    /**
     * @param {?} format
     * @return {?}
     */
    ODataQuery.prototype.format = /**
     * @param {?} format
     * @return {?}
     */
    function (format) {
        this.queryOptions.format(format);
        return this;
    };
    // QUERY EXECUTION
    /**
     * @param {?=} httpOptions
     * @return {?}
     */
    ODataQuery.prototype.get = /**
     * @param {?=} httpOptions
     * @return {?}
     */
    function (httpOptions) {
        return this.odataService.get(this, httpOptions);
    };
    /**
     * @param {?} body
     * @param {?=} httpOptions
     * @return {?}
     */
    ODataQuery.prototype.post = /**
     * @param {?} body
     * @param {?=} httpOptions
     * @return {?}
     */
    function (body, httpOptions) {
        return this.odataService.post(this, body, httpOptions);
    };
    /**
     * @param {?} body
     * @param {?=} etag
     * @param {?=} httpOptions
     * @return {?}
     */
    ODataQuery.prototype.patch = /**
     * @param {?} body
     * @param {?=} etag
     * @param {?=} httpOptions
     * @return {?}
     */
    function (body, etag, httpOptions) {
        return this.odataService.patch(this, body, etag, httpOptions);
    };
    /**
     * @param {?} body
     * @param {?=} etag
     * @param {?=} httpOptions
     * @return {?}
     */
    ODataQuery.prototype.put = /**
     * @param {?} body
     * @param {?=} etag
     * @param {?=} httpOptions
     * @return {?}
     */
    function (body, etag, httpOptions) {
        return this.odataService.put(this, body, etag, httpOptions);
    };
    /**
     * @param {?=} etag
     * @param {?=} httpOptions
     * @return {?}
     */
    ODataQuery.prototype.delete = /**
     * @param {?=} etag
     * @param {?=} httpOptions
     * @return {?}
     */
    function (etag, httpOptions) {
        return this.odataService.delete(this, etag, httpOptions);
    };
    /**
     * @return {?}
     */
    ODataQuery.prototype.toString = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var res = this.queryString;
        if (Utils.isNotNullNorUndefined(this.queryOptions) && !this.queryOptions.isEmpty()) {
            res += '?' + this.queryOptions.toString();
        }
        return res;
    };
    /**
     * @param {?} segment
     * @return {?}
     */
    ODataQuery.prototype.getSegment = /**
     * @param {?} segment
     * @return {?}
     */
    function (segment) {
        Utils.requireNotNull(segment, 'segment');
        /** @type {?} */
        var res = this.segments.find(function (value, index, segments) {
            return value === segment;
        });
        return res;
    };
    /**
     * @param {?} segment
     * @return {?}
     */
    ODataQuery.prototype.addSegment = /**
     * @param {?} segment
     * @return {?}
     */
    function (segment) {
        Utils.requireNotNull(segment, 'segment');
        this.segments.push(segment);
        if (Utils.isNotNullNorUndefined(this.segments) && this.segments.length) {
            this.lastSegment = this.segments[this.segments.length - 1];
        }
    };
    // QUERY OPTIONS SEPARATOR
    ODataQuery.SEPARATOR = '&';
    ODataQuery.METADATA = 'metadata';
    ODataQuery.ENTITY_SET = 'entitySet';
    ODataQuery.ENTITY_KEY = 'entityKey';
    ODataQuery.SINGLETON = 'singleton';
    ODataQuery.TYPE_NAME = 'typeName';
    ODataQuery.PROPERTY = 'property';
    ODataQuery.NAVIGATION_PROPERTY = 'navigationProperty';
    ODataQuery.REF = 'ref';
    ODataQuery.VALUE = 'value';
    ODataQuery.COUNT = 'count';
    ODataQuery.FUNCTION_CALL = 'functionCall';
    ODataQuery.ACTION_CALL = 'actionCall';
    ODataQuery.$METADATA = '$metadata';
    ODataQuery.$REF = '$ref';
    ODataQuery.$VALUE = '$value';
    ODataQuery.$COUNT = '$count';
    return ODataQuery;
}(ODataQueryAbstract));
export { ODataQuery };
if (false) {
    /** @type {?} */
    ODataQuery.SEPARATOR;
    /** @type {?} */
    ODataQuery.METADATA;
    /** @type {?} */
    ODataQuery.ENTITY_SET;
    /** @type {?} */
    ODataQuery.ENTITY_KEY;
    /** @type {?} */
    ODataQuery.SINGLETON;
    /** @type {?} */
    ODataQuery.TYPE_NAME;
    /** @type {?} */
    ODataQuery.PROPERTY;
    /** @type {?} */
    ODataQuery.NAVIGATION_PROPERTY;
    /** @type {?} */
    ODataQuery.REF;
    /** @type {?} */
    ODataQuery.VALUE;
    /** @type {?} */
    ODataQuery.COUNT;
    /** @type {?} */
    ODataQuery.FUNCTION_CALL;
    /** @type {?} */
    ODataQuery.ACTION_CALL;
    /** @type {?} */
    ODataQuery.$METADATA;
    /** @type {?} */
    ODataQuery.$REF;
    /** @type {?} */
    ODataQuery.$VALUE;
    /** @type {?} */
    ODataQuery.$COUNT;
    /** @type {?} */
    ODataQuery.prototype.queryOptions;
    /** @type {?} */
    ODataQuery.prototype.segments;
    /** @type {?} */
    ODataQuery.prototype.lastSegment;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2RhdGEtcXVlcnkuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9vZGF0YS12NC1uZy8iLCJzb3VyY2VzIjpbImxpYi9vZGF0YS1xdWVyeS9vZGF0YS1xdWVyeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQVFBLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUU5RCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkMsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDNUQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDOztJQUV0QixzQ0FBa0I7SUE2QmhELG9CQUFZLFlBQTBCLEVBQUUsV0FBbUI7UUFBM0QsWUFDRSxrQkFBTSxZQUFZLEVBQUUsV0FBVyxDQUFDLFNBT2pDO1FBTkMsS0FBSyxDQUFDLDBCQUEwQixDQUFDLFlBQVksRUFBRSxjQUFjLENBQUMsQ0FBQztRQUMvRCxLQUFLLENBQUMsMEJBQTBCLENBQUMsV0FBVyxFQUFFLGFBQWEsQ0FBQyxDQUFDO1FBQzdELEtBQUssQ0FBQyxlQUFlLENBQUMsV0FBVyxFQUFFLGFBQWEsQ0FBQyxDQUFDO1FBQ2xELEtBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxZQUFZLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzNELEtBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ25CLEtBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDOztLQUN6QjtJQUVELGlCQUFpQjs7OztJQUVqQiw2QkFBUTs7O0lBQVI7UUFDRSxLQUFLLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQUUsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3hGLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUN6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QWtCO1NBQXJDLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IE9EYXRhUmVzcG9uc2UgfSBmcm9tICcuLi9vZGF0YS1yZXNwb25zZS9vZGF0YS1yZXNwb25zZSc7XG5pbXBvcnQgeyBIdHRwT3B0aW9uc0kgfSBmcm9tICcuLi9vZGF0YS1zZXJ2aWNlL2h0dHAtb3B0aW9ucyc7XG5pbXBvcnQgeyBPRGF0YVNlcnZpY2UgfSBmcm9tICcuLi9vZGF0YS1zZXJ2aWNlL29kYXRhLnNlcnZpY2UnO1xuaW1wb3J0IHsgRXhwYW5kIH0gZnJvbSAnLi4vcXVlcnktb3B0aW9ucy9leHBhbmQnO1xuaW1wb3J0IHsgRmlsdGVyIH0gZnJvbSAnLi4vcXVlcnktb3B0aW9ucy9maWx0ZXIvZmlsdGVyJztcbmltcG9ydCB7IE9yZGVyYnkgfSBmcm9tICcuLi9xdWVyeS1vcHRpb25zL29yZGVyYnknO1xuaW1wb3J0IHsgUXVlcnlPcHRpb25zIH0gZnJvbSAnLi4vcXVlcnktb3B0aW9ucy9xdWVyeS1vcHRpb25zJztcbmltcG9ydCB7IFNlYXJjaCB9IGZyb20gJy4uL3F1ZXJ5LW9wdGlvbnMvc2VhcmNoL3NlYXJjaCc7XG5pbXBvcnQgeyBVdGlscyB9IGZyb20gJy4uL3V0aWxzL3V0aWxzJztcbmltcG9ydCB7IE9EYXRhUXVlcnlBYnN0cmFjdCB9IGZyb20gJy4vb2RhdGEtcXVlcnktYWJzdHJhY3QnO1xuaW1wb3J0IHsgT0RhdGFRdWVyeUJhdGNoIH0gZnJvbSAnLi9vZGF0YS1xdWVyeS1iYXRjaCc7XG5cbmV4cG9ydCBjbGFzcyBPRGF0YVF1ZXJ5IGV4dGVuZHMgT0RhdGFRdWVyeUFic3RyYWN0IHtcbiAgLy8gUVVFUlkgT1BUSU9OUyBTRVBBUkFUT1JcbiAgc3RhdGljIHJlYWRvbmx5IFNFUEFSQVRPUiA9ICcmJztcblxuICAvLyBTRUdNRU5UIE5BTUVTXG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IE1FVEFEQVRBID0gJ21ldGFkYXRhJztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgRU5USVRZX1NFVCA9ICdlbnRpdHlTZXQnO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBFTlRJVFlfS0VZID0gJ2VudGl0eUtleSc7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFNJTkdMRVRPTiA9ICdzaW5nbGV0b24nO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBUWVBFX05BTUUgPSAndHlwZU5hbWUnO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBQUk9QRVJUWSA9ICdwcm9wZXJ0eSc7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IE5BVklHQVRJT05fUFJPUEVSVFkgPSAnbmF2aWdhdGlvblByb3BlcnR5JztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgUkVGID0gJ3JlZic7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFZBTFVFID0gJ3ZhbHVlJztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgQ09VTlQgPSAnY291bnQnO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBGVU5DVElPTl9DQUxMID0gJ2Z1bmN0aW9uQ2FsbCc7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IEFDVElPTl9DQUxMID0gJ2FjdGlvbkNhbGwnO1xuXG4gIC8vIENPTlNUQU5UIFNFR01FTlRTXG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5ICRNRVRBREFUQSA9ICckbWV0YWRhdGEnO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSAkUkVGID0gJyRyZWYnO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSAkVkFMVUUgPSAnJHZhbHVlJztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgJENPVU5UID0gJyRjb3VudCc7XG5cbiAgLy8gVkFSSUFCTEVTXG4gIHByaXZhdGUgcXVlcnlPcHRpb25zOiBRdWVyeU9wdGlvbnM7XG4gIHByaXZhdGUgc2VnbWVudHM6IHN0cmluZ1tdO1xuICBwcml2YXRlIGxhc3RTZWdtZW50OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3Iob2RhdGFTZXJ2aWNlOiBPRGF0YVNlcnZpY2UsIHNlcnZpY2VSb290OiBzdHJpbmcpIHtcbiAgICBzdXBlcihvZGF0YVNlcnZpY2UsIHNlcnZpY2VSb290KTtcbiAgICBVdGlscy5yZXF1aXJlTm90TnVsbE5vclVuZGVmaW5lZChvZGF0YVNlcnZpY2UsICdvZGF0YVNlcnZpY2UnKTtcbiAgICBVdGlscy5yZXF1aXJlTm90TnVsbE5vclVuZGVmaW5lZChzZXJ2aWNlUm9vdCwgJ3NlcnZpY2VSb290Jyk7XG4gICAgVXRpbHMucmVxdWlyZU5vdEVtcHR5KHNlcnZpY2VSb290LCAnc2VydmljZVJvb3QnKTtcbiAgICB0aGlzLnF1ZXJ5T3B0aW9ucyA9IG5ldyBRdWVyeU9wdGlvbnMoT0RhdGFRdWVyeS5TRVBBUkFUT1IpO1xuICAgIHRoaXMuc2VnbWVudHMgPSBbXTtcbiAgICB0aGlzLmxhc3RTZWdtZW50ID0gbnVsbDtcbiAgfVxuXG4gIC8vIFFVRVJZIFNFR01FTlRTXG5cbiAgbWV0YWRhdGEoKTogT0RhdGFRdWVyeSB7XG4gICAgVXRpbHMucmVxdWlyZU51bGxPclVuZGVmaW5lZCh0aGlzLmdldFNlZ21lbnQoT0RhdGFRdWVyeS5NRVRBREFUQSksIE9EYXRhUXVlcnkuTUVUQURBVEEpO1xuICAgIGlmICh0aGlzLnNlZ21lbnRzLmxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdtZXRhZGF0YSBzZWdtZW50IGNhbm5vdCBiZSBhcHBlbmRlZCB0byBvdGhlciBzZWdtZW50cycpO1xuICAgIH1cbiAgICB0aGlzLnF1ZXJ5U3RyaW5nID0gVXRpbHMuYXBwZW5kU2VnbWVudCh0aGlzLnF1ZXJ5U3RyaW5nLCBPRGF0YVF1ZXJ5LiRNRVRBREFUQSk7XG4gICAgdGhpcy5hZGRTZWdtZW50KE9EYXRhUXVlcnkuTUVUQURBVEEpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZW50aXR5U2V0KGVudGl0eVNldDogc3RyaW5nKTogT0RhdGFRdWVyeSB7XG4gICAgVXRpbHMucmVxdWlyZU51bGxPclVuZGVmaW5lZCh0aGlzLmdldFNlZ21lbnQoT0RhdGFRdWVyeS5FTlRJVFlfU0VUKSwgT0RhdGFRdWVyeS5FTlRJVFlfU0VUKTtcbiAgICBVdGlscy5yZXF1aXJlTm90TnVsbE5vclVuZGVmaW5lZChlbnRpdHlTZXQsICdlbnRpdHlTZXQnKTtcbiAgICBVdGlscy5yZXF1aXJlTm90RW1wdHkoZW50aXR5U2V0LCAnZW50aXR5U2V0Jyk7XG4gICAgdGhpcy5xdWVyeVN0cmluZyA9IFV0aWxzLmFwcGVuZFNlZ21lbnQodGhpcy5xdWVyeVN0cmluZywgZW50aXR5U2V0KTtcbiAgICB0aGlzLmFkZFNlZ21lbnQoT0RhdGFRdWVyeS5FTlRJVFlfU0VUKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGVudGl0eUtleShlbnRpdHlLZXk6IGFueSB8IGFueVtdKTogT0RhdGFRdWVyeSB7XG4gICAgaWYgKHRoaXMubGFzdFNlZ21lbnQgIT09IE9EYXRhUXVlcnkuRU5USVRZX1NFVCAmJiB0aGlzLmxhc3RTZWdtZW50ICE9PSBPRGF0YVF1ZXJ5Lk5BVklHQVRJT05fUFJPUEVSVFkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignZW50aXR5S2V5IGNhbiBvbmx5IGJlIGFwcGVuZGVkIHRvIGVudGl0eVNldCBvciBuYXZpZ2F0aW9uUHJvcGVydHknKTtcbiAgICB9XG4gICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQoZW50aXR5S2V5LCAnZW50aXR5S2V5Jyk7XG4gICAgVXRpbHMucmVxdWlyZU5vdEVtcHR5KGVudGl0eUtleSwgJ2VudGl0eUtleScpO1xuICAgIGVudGl0eUtleSA9IFV0aWxzLmdldFZhbHVlVVJJKGVudGl0eUtleSwgdHJ1ZSk7XG4gICAgdGhpcy5xdWVyeVN0cmluZyA9IFV0aWxzLnJlbW92ZUVuZGluZ1NlcGFyYXRvcih0aGlzLnF1ZXJ5U3RyaW5nKSArICcoJyArIGVudGl0eUtleSArICcpJztcbiAgICB0aGlzLmFkZFNlZ21lbnQoT0RhdGFRdWVyeS5FTlRJVFlfS0VZKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNpbmdsZXRvbihzaW5nbGV0b246IHN0cmluZykge1xuICAgIGlmICh0aGlzLnNlZ21lbnRzLmxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdzaW5nbGV0b24gc2VnbWVudCBjYW5ub3QgYmUgYXBwZW5kZWQgdG8gb3RoZXIgc2VnbWVudHMnKTtcbiAgICB9XG4gICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQoc2luZ2xldG9uLCAnc2luZ2xldG9uJyk7XG4gICAgVXRpbHMucmVxdWlyZU5vdEVtcHR5KHNpbmdsZXRvbiwgJ3NpbmdsZXRvbicpO1xuICAgIHRoaXMucXVlcnlTdHJpbmcgPSBVdGlscy5hcHBlbmRTZWdtZW50KHRoaXMucXVlcnlTdHJpbmcsIHNpbmdsZXRvbik7XG4gICAgdGhpcy5hZGRTZWdtZW50KE9EYXRhUXVlcnkuU0lOR0xFVE9OKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHR5cGVOYW1lKHR5cGVOYW1lOiBzdHJpbmcpIHtcbiAgICBpZiAodGhpcy5sYXN0U2VnbWVudCAhPT0gT0RhdGFRdWVyeS5FTlRJVFlfU0VUICYmIHRoaXMubGFzdFNlZ21lbnQgIT09IE9EYXRhUXVlcnkuTkFWSUdBVElPTl9QUk9QRVJUWSAmJiB0aGlzLmxhc3RTZWdtZW50ICE9PSBPRGF0YVF1ZXJ5LkVOVElUWV9LRVkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcigndHlwZU5hbWUgY2FuIG9ubHkgYmUgYXBwZW5kZWQgdG8gZW50aXR5U2V0LCBuYXZpZ2F0aW9uUHJvcGVydHkgb3IgZW50aXR5S2V5Jyk7XG4gICAgfVxuICAgIFV0aWxzLnJlcXVpcmVOb3ROdWxsTm9yVW5kZWZpbmVkKHR5cGVOYW1lLCAndHlwZU5hbWUnKTtcbiAgICBVdGlscy5yZXF1aXJlTm90RW1wdHkodHlwZU5hbWUsICd0eXBlTmFtZScpO1xuICAgIHRoaXMucXVlcnlTdHJpbmcgPSBVdGlscy5hcHBlbmRTZWdtZW50KHRoaXMucXVlcnlTdHJpbmcsIHR5cGVOYW1lKTtcbiAgICB0aGlzLmFkZFNlZ21lbnQoT0RhdGFRdWVyeS5UWVBFX05BTUUpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcHJvcGVydHkocHJvcGVydHk6IHN0cmluZyk6IE9EYXRhUXVlcnkge1xuICAgIFV0aWxzLnJlcXVpcmVOdWxsT3JVbmRlZmluZWQodGhpcy5nZXRTZWdtZW50KE9EYXRhUXVlcnkuUFJPUEVSVFkpLCBPRGF0YVF1ZXJ5LlBST1BFUlRZKTtcbiAgICBpZiAodGhpcy5sYXN0U2VnbWVudCAhPT0gT0RhdGFRdWVyeS5FTlRJVFlfS0VZICYmIHRoaXMubGFzdFNlZ21lbnQgIT09IE9EYXRhUXVlcnkuU0lOR0xFVE9OKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb3BlcnR5IGNhbiBvbmx5IGJlIGFwcGVuZGVkIHRvIGVudGl0eUtleSBvciBzaW5nbGV0b24nKTtcbiAgICB9XG4gICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQocHJvcGVydHksICdwcm9wZXJ0eScpO1xuICAgIFV0aWxzLnJlcXVpcmVOb3RFbXB0eShwcm9wZXJ0eSwgJ3Byb3BlcnR5Jyk7XG4gICAgdGhpcy5xdWVyeVN0cmluZyA9IFV0aWxzLmFwcGVuZFNlZ21lbnQodGhpcy5xdWVyeVN0cmluZywgcHJvcGVydHkpO1xuICAgIHRoaXMuYWRkU2VnbWVudChPRGF0YVF1ZXJ5LlBST1BFUlRZKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG5hdmlnYXRpb25Qcm9wZXJ0eShuYXZpZ2F0aW9uUHJvcGVydHk6IHN0cmluZyk6IE9EYXRhUXVlcnkge1xuICAgIGlmICh0aGlzLmxhc3RTZWdtZW50ICE9PSBPRGF0YVF1ZXJ5LkVOVElUWV9LRVkgJiYgdGhpcy5sYXN0U2VnbWVudCAhPT0gT0RhdGFRdWVyeS5TSU5HTEVUT04gJiYgdGhpcy5sYXN0U2VnbWVudCAhPT0gT0RhdGFRdWVyeS5UWVBFX05BTUUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignbmF2aWdhdGlvblByb3BlcnR5IGNhbiBvbmx5IGJlIGFwcGVuZGVkIHRvIGVudGl0eUtleSwgc2luZ2xldG9uIG9yIHR5cGVOYW1lJyk7XG4gICAgfVxuICAgIFV0aWxzLnJlcXVpcmVOb3ROdWxsTm9yVW5kZWZpbmVkKG5hdmlnYXRpb25Qcm9wZXJ0eSwgJ25hdmlnYXRpb25Qcm9wZXJ0eScpO1xuICAgIFV0aWxzLnJlcXVpcmVOb3RFbXB0eShuYXZpZ2F0aW9uUHJvcGVydHksICduYXZpZ2F0aW9uUHJvcGVydHknKTtcbiAgICB0aGlzLnF1ZXJ5U3RyaW5nID0gVXRpbHMuYXBwZW5kU2VnbWVudCh0aGlzLnF1ZXJ5U3RyaW5nLCBuYXZpZ2F0aW9uUHJvcGVydHkpO1xuICAgIHRoaXMuYWRkU2VnbWVudChPRGF0YVF1ZXJ5Lk5BVklHQVRJT05fUFJPUEVSVFkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcmVmKCk6IE9EYXRhUXVlcnkge1xuICAgIFV0aWxzLnJlcXVpcmVOdWxsT3JVbmRlZmluZWQodGhpcy5nZXRTZWdtZW50KE9EYXRhUXVlcnkuUkVGKSwgT0RhdGFRdWVyeS5SRUYpO1xuICAgIGlmICh0aGlzLmxhc3RTZWdtZW50ICE9PSBPRGF0YVF1ZXJ5Lk5BVklHQVRJT05fUFJPUEVSVFkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcigncmVmIGNhbiBvbmx5IGJlIGFwcGVuZGVkIHRvIG5hdmlnYXRpb25Qcm9wZXJ0eScpO1xuICAgIH1cbiAgICB0aGlzLnF1ZXJ5U3RyaW5nID0gVXRpbHMuYXBwZW5kU2VnbWVudCh0aGlzLnF1ZXJ5U3RyaW5nLCBPRGF0YVF1ZXJ5LiRSRUYpO1xuICAgIHRoaXMuYWRkU2VnbWVudChPRGF0YVF1ZXJ5LlJFRik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICB2YWx1ZSgpOiBPRGF0YVF1ZXJ5IHtcbiAgICBVdGlscy5yZXF1aXJlTnVsbE9yVW5kZWZpbmVkKHRoaXMuZ2V0U2VnbWVudChPRGF0YVF1ZXJ5LlZBTFVFKSwgT0RhdGFRdWVyeS5WQUxVRSk7XG4gICAgaWYgKHRoaXMubGFzdFNlZ21lbnQgIT09IE9EYXRhUXVlcnkuUFJPUEVSVFkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcigndmFsdWUgY2FuIG9ubHkgYmUgYXBwZW5kZWQgdG8gcHJvcGVydHknKTtcbiAgICB9XG4gICAgdGhpcy5xdWVyeVN0cmluZyA9IFV0aWxzLmFwcGVuZFNlZ21lbnQodGhpcy5xdWVyeVN0cmluZywgT0RhdGFRdWVyeS4kVkFMVUUpO1xuICAgIHRoaXMuYWRkU2VnbWVudChPRGF0YVF1ZXJ5LlZBTFVFKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGNvdW50U2VnbWVudCgpOiBPRGF0YVF1ZXJ5IHtcbiAgICBVdGlscy5yZXF1aXJlTnVsbE9yVW5kZWZpbmVkKHRoaXMuZ2V0U2VnbWVudChPRGF0YVF1ZXJ5LkNPVU5UKSwgT0RhdGFRdWVyeS5DT1VOVCk7XG4gICAgaWYgKHRoaXMubGFzdFNlZ21lbnQgIT09IE9EYXRhUXVlcnkuRU5USVRZX1NFVCAmJiB0aGlzLmxhc3RTZWdtZW50ICE9PSBPRGF0YVF1ZXJ5Lk5BVklHQVRJT05fUFJPUEVSVFkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignY291bnQgY2FuIG9ubHkgYmUgYXBwZW5kZWQgdG8gZW50aXR5U2V0IG9yIG5hdmlnYXRpb25Qcm9wZXJ0eScpO1xuICAgIH1cbiAgICB0aGlzLnF1ZXJ5U3RyaW5nID0gVXRpbHMuYXBwZW5kU2VnbWVudCh0aGlzLnF1ZXJ5U3RyaW5nLCBPRGF0YVF1ZXJ5LiRDT1VOVCk7XG4gICAgdGhpcy5hZGRTZWdtZW50KE9EYXRhUXVlcnkuQ09VTlQpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZnVuY3Rpb25DYWxsKGZ1bmN0aW9uQ2FsbDogc3RyaW5nKTogT0RhdGFRdWVyeSB7XG4gICAgVXRpbHMucmVxdWlyZU5vdE51bGxOb3JVbmRlZmluZWQoZnVuY3Rpb25DYWxsLCAnZnVuY3Rpb25DYWxsJyk7XG4gICAgVXRpbHMucmVxdWlyZU5vdEVtcHR5KGZ1bmN0aW9uQ2FsbCwgJ2Z1bmN0aW9uQ2FsbCcpO1xuICAgIHRoaXMucXVlcnlTdHJpbmcgPSBVdGlscy5hcHBlbmRTZWdtZW50KHRoaXMucXVlcnlTdHJpbmcsIGZ1bmN0aW9uQ2FsbCk7XG4gICAgdGhpcy5hZGRTZWdtZW50KE9EYXRhUXVlcnkuRlVOQ1RJT05fQ0FMTCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBhY3Rpb25DYWxsKGFjdGlvbkNhbGw6IHN0cmluZyk6IE9EYXRhUXVlcnkge1xuICAgIFV0aWxzLnJlcXVpcmVOb3ROdWxsTm9yVW5kZWZpbmVkKGFjdGlvbkNhbGwsICdhY3Rpb25DYWxsJyk7XG4gICAgVXRpbHMucmVxdWlyZU5vdEVtcHR5KGFjdGlvbkNhbGwsICdhY3Rpb25DYWxsJyk7XG4gICAgdGhpcy5xdWVyeVN0cmluZyA9IFV0aWxzLmFwcGVuZFNlZ21lbnQodGhpcy5xdWVyeVN0cmluZywgYWN0aW9uQ2FsbCk7XG4gICAgdGhpcy5hZGRTZWdtZW50KE9EYXRhUXVlcnkuQUNUSU9OX0NBTEwpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYmF0Y2goKTogT0RhdGFRdWVyeUJhdGNoIHtcbiAgICByZXR1cm4gbmV3IE9EYXRhUXVlcnlCYXRjaCh0aGlzLm9kYXRhU2VydmljZSwgdGhpcy5zZXJ2aWNlUm9vdCk7XG4gIH1cblxuICAvLyBRVUVSWSBPUFRJT05TXG5cbiAgc2VsZWN0KHNlbGVjdDogc3RyaW5nIHwgc3RyaW5nW10pOiBPRGF0YVF1ZXJ5IHtcbiAgICB0aGlzLnF1ZXJ5T3B0aW9ucy5zZWxlY3Qoc2VsZWN0KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGZpbHRlcihmaWx0ZXI6IHN0cmluZyB8IEZpbHRlcik6IE9EYXRhUXVlcnkge1xuICAgIHRoaXMucXVlcnlPcHRpb25zLmZpbHRlcihmaWx0ZXIpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZXhwYW5kKGV4cGFuZDogc3RyaW5nIHwgRXhwYW5kIHwgRXhwYW5kW10pOiBPRGF0YVF1ZXJ5IHtcbiAgICB0aGlzLnF1ZXJ5T3B0aW9ucy5leHBhbmQoZXhwYW5kKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG9yZGVyYnkob3JkZXJieTogc3RyaW5nIHwgT3JkZXJieVtdKTogT0RhdGFRdWVyeSB7XG4gICAgdGhpcy5xdWVyeU9wdGlvbnMub3JkZXJieShvcmRlcmJ5KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNlYXJjaChzZWFyY2g6IHN0cmluZyB8IFNlYXJjaCk6IE9EYXRhUXVlcnkge1xuICAgIHRoaXMucXVlcnlPcHRpb25zLnNlYXJjaChzZWFyY2gpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgc2tpcChza2lwOiBudW1iZXIpOiBPRGF0YVF1ZXJ5IHtcbiAgICB0aGlzLnF1ZXJ5T3B0aW9ucy5za2lwKHNraXApO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgdG9wKHRvcDogbnVtYmVyKTogT0RhdGFRdWVyeSB7XG4gICAgdGhpcy5xdWVyeU9wdGlvbnMudG9wKHRvcCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBjb3VudE9wdGlvbihjb3VudDogYm9vbGVhbik6IE9EYXRhUXVlcnkge1xuICAgIHRoaXMucXVlcnlPcHRpb25zLmNvdW50KGNvdW50KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGN1c3RvbU9wdGlvbihrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMucXVlcnlPcHRpb25zLmN1c3RvbU9wdGlvbihrZXksIHZhbHVlKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGZvcm1hdChmb3JtYXQ6IHN0cmluZyk6IE9EYXRhUXVlcnkge1xuICAgIHRoaXMucXVlcnlPcHRpb25zLmZvcm1hdChmb3JtYXQpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLy8gUVVFUlkgRVhFQ1VUSU9OXG5cbiAgZ2V0KGh0dHBPcHRpb25zPzogSHR0cE9wdGlvbnNJKTogT2JzZXJ2YWJsZTxPRGF0YVJlc3BvbnNlPiB7XG4gICAgcmV0dXJuIHRoaXMub2RhdGFTZXJ2aWNlLmdldCh0aGlzLCBodHRwT3B0aW9ucyk7XG4gIH1cblxuICBwb3N0KGJvZHk6IGFueSwgaHR0cE9wdGlvbnM/OiBIdHRwT3B0aW9uc0kpOiBPYnNlcnZhYmxlPE9EYXRhUmVzcG9uc2U+IHtcbiAgICByZXR1cm4gdGhpcy5vZGF0YVNlcnZpY2UucG9zdCh0aGlzLCBib2R5LCBodHRwT3B0aW9ucyk7XG4gIH1cblxuICBwYXRjaChib2R5OiBhbnksIGV0YWc/OiBzdHJpbmcsIGh0dHBPcHRpb25zPzogSHR0cE9wdGlvbnNJKTogT2JzZXJ2YWJsZTxPRGF0YVJlc3BvbnNlPiB7XG4gICAgcmV0dXJuIHRoaXMub2RhdGFTZXJ2aWNlLnBhdGNoKHRoaXMsIGJvZHksIGV0YWcsIGh0dHBPcHRpb25zKTtcbiAgfVxuXG4gIHB1dChib2R5OiBhbnksIGV0YWc/OiBzdHJpbmcsIGh0dHBPcHRpb25zPzogSHR0cE9wdGlvbnNJKTogT2JzZXJ2YWJsZTxPRGF0YVJlc3BvbnNlPiB7XG4gICAgcmV0dXJuIHRoaXMub2RhdGFTZXJ2aWNlLnB1dCh0aGlzLCBib2R5LCBldGFnLCBodHRwT3B0aW9ucyk7XG4gIH1cblxuICBkZWxldGUoZXRhZz86IHN0cmluZywgaHR0cE9wdGlvbnM/OiBIdHRwT3B0aW9uc0kpOiBPYnNlcnZhYmxlPE9EYXRhUmVzcG9uc2U+IHtcbiAgICByZXR1cm4gdGhpcy5vZGF0YVNlcnZpY2UuZGVsZXRlKHRoaXMsIGV0YWcsIGh0dHBPcHRpb25zKTtcbiAgfVxuXG4gIHRvU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgbGV0IHJlczogc3RyaW5nID0gdGhpcy5xdWVyeVN0cmluZztcbiAgICBpZiAoVXRpbHMuaXNOb3ROdWxsTm9yVW5kZWZpbmVkKHRoaXMucXVlcnlPcHRpb25zKSAmJiAhdGhpcy5xdWVyeU9wdGlvbnMuaXNFbXB0eSgpKSB7XG4gICAgICByZXMgKz0gJz8nICsgdGhpcy5xdWVyeU9wdGlvbnMudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlcztcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRTZWdtZW50KHNlZ21lbnQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgVXRpbHMucmVxdWlyZU5vdE51bGwoc2VnbWVudCwgJ3NlZ21lbnQnKTtcbiAgICBjb25zdCByZXM6IHN0cmluZyA9IHRoaXMuc2VnbWVudHMuZmluZCgodmFsdWU6IHN0cmluZywgaW5kZXg6IG51bWJlciwgc2VnbWVudHM6IHN0cmluZ1tdKSA9PiB7XG4gICAgICByZXR1cm4gdmFsdWUgPT09IHNlZ21lbnQ7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlcztcbiAgfVxuXG4gIHByb3RlY3RlZCBhZGRTZWdtZW50KHNlZ21lbnQ6IHN0cmluZyk6IHZvaWQge1xuICAgIFV0aWxzLnJlcXVpcmVOb3ROdWxsKHNlZ21lbnQsICdzZWdtZW50Jyk7XG4gICAgdGhpcy5zZWdtZW50cy5wdXNoKHNlZ21lbnQpO1xuICAgIGlmIChVdGlscy5pc05vdE51bGxOb3JVbmRlZmluZWQodGhpcy5zZWdtZW50cykgJiYgdGhpcy5zZWdtZW50cy5sZW5ndGgpIHtcbiAgICAgIHRoaXMubGFzdFNlZ21lbnQgPSB0aGlzLnNlZ21lbnRzW3RoaXMuc2VnbWVudHMubGVuZ3RoIC0gMV07XG4gICAgfVxuICB9XG59XG4iXX0=